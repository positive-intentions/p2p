"use strict";(self.webpackChunkfrontend_base=self.webpackChunkfrontend_base||[]).push([[775],{"./node_modules/peerjs/dist/bundler.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{ZP:()=>$dd0187d7f28e386f$export$2e2bcd8739ae039});var chrome_shim_namespaceObject={};__webpack_require__.r(chrome_shim_namespaceObject),__webpack_require__.d(chrome_shim_namespaceObject,{fixNegotiationNeeded:()=>fixNegotiationNeeded,shimAddTrackRemoveTrack:()=>shimAddTrackRemoveTrack,shimAddTrackRemoveTrackWithNative:()=>shimAddTrackRemoveTrackWithNative,shimGetSendersWithDtmf:()=>shimGetSendersWithDtmf,shimGetUserMedia:()=>shimGetUserMedia,shimMediaStream:()=>shimMediaStream,shimOnTrack:()=>shimOnTrack,shimPeerConnection:()=>shimPeerConnection,shimSenderReceiverGetStats:()=>shimSenderReceiverGetStats});var firefox_shim_namespaceObject={};__webpack_require__.r(firefox_shim_namespaceObject),__webpack_require__.d(firefox_shim_namespaceObject,{shimAddTransceiver:()=>shimAddTransceiver,shimCreateAnswer:()=>shimCreateAnswer,shimCreateOffer:()=>shimCreateOffer,shimGetDisplayMedia:()=>shimGetDisplayMedia,shimGetParameters:()=>shimGetParameters,shimGetUserMedia:()=>getusermedia_shimGetUserMedia,shimOnTrack:()=>firefox_shim_shimOnTrack,shimPeerConnection:()=>firefox_shim_shimPeerConnection,shimRTCDataChannel:()=>shimRTCDataChannel,shimReceiverGetStats:()=>shimReceiverGetStats,shimRemoveStream:()=>shimRemoveStream,shimSenderGetStats:()=>shimSenderGetStats});var safari_shim_namespaceObject={};__webpack_require__.r(safari_shim_namespaceObject),__webpack_require__.d(safari_shim_namespaceObject,{shimAudioContext:()=>shimAudioContext,shimCallbacksAPI:()=>shimCallbacksAPI,shimConstraints:()=>shimConstraints,shimCreateOfferLegacy:()=>shimCreateOfferLegacy,shimGetUserMedia:()=>safari_shim_shimGetUserMedia,shimLocalStreamsAPI:()=>shimLocalStreamsAPI,shimRTCIceServerUrls:()=>shimRTCIceServerUrls,shimRemoteStreamsAPI:()=>shimRemoteStreamsAPI,shimTrackEventTransceiver:()=>shimTrackEventTransceiver});var common_shim_namespaceObject={};__webpack_require__.r(common_shim_namespaceObject),__webpack_require__.d(common_shim_namespaceObject,{removeExtmapAllowMixed:()=>removeExtmapAllowMixed,shimAddIceCandidateNullOrEmpty:()=>shimAddIceCandidateNullOrEmpty,shimConnectionState:()=>shimConnectionState,shimMaxMessageSize:()=>shimMaxMessageSize,shimParameterlessSetLocalDescription:()=>shimParameterlessSetLocalDescription,shimRTCIceCandidate:()=>shimRTCIceCandidate,shimRTCIceCandidateRelayProtocol:()=>shimRTCIceCandidateRelayProtocol,shimSendThrowTypeError:()=>shimSendThrowTypeError});class $e8379818650e2442$export$93654d4f2d6cd524{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(data){this.flush(),this._parts.push(data)}append(data){this._pieces.push(data)}flush(){if(this._pieces.length>0){const buf=new Uint8Array(this._pieces);this._parts.push(buf),this._pieces=[]}}toArrayBuffer(){const buffer=[];for(const part of this._parts)buffer.push(part);return function $e8379818650e2442$var$concatArrayBuffers(bufs){let size=0;for(const buf of bufs)size+=buf.byteLength;const result=new Uint8Array(size);let offset=0;for(const buf of bufs){const view=new Uint8Array(buf.buffer,buf.byteOffset,buf.byteLength);result.set(view,offset),offset+=buf.byteLength}return result}(buffer).buffer}}function $0cfd7828ad59115f$export$417857010dc9287f(data){return new $0cfd7828ad59115f$var$Unpacker(data).unpack()}function $0cfd7828ad59115f$export$2a703dbb0cb35339(data){const packer=new $0cfd7828ad59115f$export$b9ec4b114aa40074,res=packer.pack(data);return res instanceof Promise?res.then((()=>packer.getBuffer())):packer.getBuffer()}class $0cfd7828ad59115f$var$Unpacker{constructor(data){this.index=0,this.dataBuffer=data,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const type=this.unpack_uint8();if(type<128)return type;if((224^type)<32)return(224^type)-32;let size;if((size=160^type)<=15)return this.unpack_raw(size);if((size=176^type)<=15)return this.unpack_string(size);if((size=144^type)<=15)return this.unpack_array(size);if((size=128^type)<=15)return this.unpack_map(size);switch(type){case 192:return null;case 193:case 212:case 213:case 214:case 215:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 216:return size=this.unpack_uint16(),this.unpack_string(size);case 217:return size=this.unpack_uint32(),this.unpack_string(size);case 218:return size=this.unpack_uint16(),this.unpack_raw(size);case 219:return size=this.unpack_uint32(),this.unpack_raw(size);case 220:return size=this.unpack_uint16(),this.unpack_array(size);case 221:return size=this.unpack_uint32(),this.unpack_array(size);case 222:return size=this.unpack_uint16(),this.unpack_map(size);case 223:return size=this.unpack_uint32(),this.unpack_map(size)}}unpack_uint8(){const byte=255&this.dataView[this.index];return this.index++,byte}unpack_uint16(){const bytes=this.read(2),uint16=256*(255&bytes[0])+(255&bytes[1]);return this.index+=2,uint16}unpack_uint32(){const bytes=this.read(4),uint32=256*(256*(256*bytes[0]+bytes[1])+bytes[2])+bytes[3];return this.index+=4,uint32}unpack_uint64(){const bytes=this.read(8),uint64=256*(256*(256*(256*(256*(256*(256*bytes[0]+bytes[1])+bytes[2])+bytes[3])+bytes[4])+bytes[5])+bytes[6])+bytes[7];return this.index+=8,uint64}unpack_int8(){const uint8=this.unpack_uint8();return uint8<128?uint8:uint8-256}unpack_int16(){const uint16=this.unpack_uint16();return uint16<32768?uint16:uint16-65536}unpack_int32(){const uint32=this.unpack_uint32();return uint32<2**31?uint32:uint32-2**32}unpack_int64(){const uint64=this.unpack_uint64();return uint64<2**63?uint64:uint64-2**64}unpack_raw(size){if(this.length<this.index+size)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${size} ${this.length}`);const buf=this.dataBuffer.slice(this.index,this.index+size);return this.index+=size,buf}unpack_string(size){const bytes=this.read(size);let c,code,i=0,str="";for(;i<size;)c=bytes[i],c<160?(code=c,i++):(192^c)<32?(code=(31&c)<<6|63&bytes[i+1],i+=2):(224^c)<16?(code=(15&c)<<12|(63&bytes[i+1])<<6|63&bytes[i+2],i+=3):(code=(7&c)<<18|(63&bytes[i+1])<<12|(63&bytes[i+2])<<6|63&bytes[i+3],i+=4),str+=String.fromCodePoint(code);return this.index+=size,str}unpack_array(size){const objects=new Array(size);for(let i=0;i<size;i++)objects[i]=this.unpack();return objects}unpack_map(size){const map={};for(let i=0;i<size;i++){map[this.unpack()]=this.unpack()}return map}unpack_float(){const uint32=this.unpack_uint32();return(0===uint32>>31?1:-1)*(8388607&uint32|8388608)*2**((uint32>>23&255)-127-23)}unpack_double(){const h32=this.unpack_uint32(),exp=(h32>>20&2047)-1023;return(0===h32>>31?1:-1)*((1048575&h32|1048576)*2**(exp-20)+this.unpack_uint32()*2**(exp-52))}read(length){const j=this.index;if(j+length<=this.length)return this.dataView.subarray(j,j+length);throw new Error("BinaryPackFailure: read index out of range")}}class $0cfd7828ad59115f$export$b9ec4b114aa40074{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(value){if("string"==typeof value)this.pack_string(value);else if("number"==typeof value)Math.floor(value)===value?this.pack_integer(value):this.pack_double(value);else if("boolean"==typeof value)!0===value?this._bufferBuilder.append(195):!1===value&&this._bufferBuilder.append(194);else if(void 0===value)this._bufferBuilder.append(192);else{if("object"!=typeof value)throw new Error(`Type "${typeof value}" not yet supported`);if(null===value)this._bufferBuilder.append(192);else{const constructor=value.constructor;if(value instanceof Array){const res=this.pack_array(value);if(res instanceof Promise)return res.then((()=>this._bufferBuilder.flush()))}else if(value instanceof ArrayBuffer)this.pack_bin(new Uint8Array(value));else if("BYTES_PER_ELEMENT"in value){const v=value;this.pack_bin(new Uint8Array(v.buffer,v.byteOffset,v.byteLength))}else if(value instanceof Date)this.pack_string(value.toString());else{if(value instanceof Blob)return value.arrayBuffer().then((buffer=>{this.pack_bin(new Uint8Array(buffer)),this._bufferBuilder.flush()}));if(constructor!=Object&&!constructor.toString().startsWith("class"))throw new Error(`Type "${constructor.toString()}" not yet supported`);{const res=this.pack_object(value);if(res instanceof Promise)return res.then((()=>this._bufferBuilder.flush()))}}}}this._bufferBuilder.flush()}pack_bin(blob){const length=blob.length;if(length<=15)this.pack_uint8(160+length);else if(length<=65535)this._bufferBuilder.append(218),this.pack_uint16(length);else{if(!(length<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(219),this.pack_uint32(length)}this._bufferBuilder.append_buffer(blob)}pack_string(str){const encoded=this._textEncoder.encode(str),length=encoded.length;if(length<=15)this.pack_uint8(176+length);else if(length<=65535)this._bufferBuilder.append(216),this.pack_uint16(length);else{if(!(length<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(217),this.pack_uint32(length)}this._bufferBuilder.append_buffer(encoded)}pack_array(ary){const length=ary.length;if(length<=15)this.pack_uint8(144+length);else if(length<=65535)this._bufferBuilder.append(220),this.pack_uint16(length);else{if(!(length<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(221),this.pack_uint32(length)}const packNext=index=>{if(index<length){const res=this.pack(ary[index]);return res instanceof Promise?res.then((()=>packNext(index+1))):packNext(index+1)}};return packNext(0)}pack_integer(num){if(num>=-32&&num<=127)this._bufferBuilder.append(255&num);else if(num>=0&&num<=255)this._bufferBuilder.append(204),this.pack_uint8(num);else if(num>=-128&&num<=127)this._bufferBuilder.append(208),this.pack_int8(num);else if(num>=0&&num<=65535)this._bufferBuilder.append(205),this.pack_uint16(num);else if(num>=-32768&&num<=32767)this._bufferBuilder.append(209),this.pack_int16(num);else if(num>=0&&num<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(num);else if(num>=-2147483648&&num<=2147483647)this._bufferBuilder.append(210),this.pack_int32(num);else if(num>=-0x8000000000000000&&num<=0x8000000000000000)this._bufferBuilder.append(211),this.pack_int64(num);else{if(!(num>=0&&num<=0x10000000000000000))throw new Error("Invalid integer");this._bufferBuilder.append(207),this.pack_uint64(num)}}pack_double(num){let sign=0;num<0&&(sign=1,num=-num);const exp=Math.floor(Math.log(num)/Math.LN2),frac0=num/2**exp-1,frac1=Math.floor(frac0*2**52),h32=sign<<31|exp+1023<<20|frac1/4294967296&1048575,l32=frac1%4294967296;this._bufferBuilder.append(203),this.pack_int32(h32),this.pack_int32(l32)}pack_object(obj){const keys=Object.keys(obj),length=keys.length;if(length<=15)this.pack_uint8(128+length);else if(length<=65535)this._bufferBuilder.append(222),this.pack_uint16(length);else{if(!(length<=4294967295))throw new Error("Invalid length");this._bufferBuilder.append(223),this.pack_uint32(length)}const packNext=index=>{if(index<keys.length){const prop=keys[index];if(obj.hasOwnProperty(prop)){this.pack(prop);const res=this.pack(obj[prop]);if(res instanceof Promise)return res.then((()=>packNext(index+1)))}return packNext(index+1)}};return packNext(0)}pack_uint8(num){this._bufferBuilder.append(num)}pack_uint16(num){this._bufferBuilder.append(num>>8),this._bufferBuilder.append(255&num)}pack_uint32(num){const n=4294967295&num;this._bufferBuilder.append((4278190080&n)>>>24),this._bufferBuilder.append((16711680&n)>>>16),this._bufferBuilder.append((65280&n)>>>8),this._bufferBuilder.append(255&n)}pack_uint64(num){const high=num/2**32,low=num%2**32;this._bufferBuilder.append((4278190080&high)>>>24),this._bufferBuilder.append((16711680&high)>>>16),this._bufferBuilder.append((65280&high)>>>8),this._bufferBuilder.append(255&high),this._bufferBuilder.append((4278190080&low)>>>24),this._bufferBuilder.append((16711680&low)>>>16),this._bufferBuilder.append((65280&low)>>>8),this._bufferBuilder.append(255&low)}pack_int8(num){this._bufferBuilder.append(255&num)}pack_int16(num){this._bufferBuilder.append((65280&num)>>8),this._bufferBuilder.append(255&num)}pack_int32(num){this._bufferBuilder.append(num>>>24&255),this._bufferBuilder.append((16711680&num)>>>16),this._bufferBuilder.append((65280&num)>>>8),this._bufferBuilder.append(255&num)}pack_int64(num){const high=Math.floor(num/2**32),low=num%2**32;this._bufferBuilder.append((4278190080&high)>>>24),this._bufferBuilder.append((16711680&high)>>>16),this._bufferBuilder.append((65280&high)>>>8),this._bufferBuilder.append(255&high),this._bufferBuilder.append((4278190080&low)>>>24),this._bufferBuilder.append((16711680&low)>>>16),this._bufferBuilder.append((65280&low)>>>8),this._bufferBuilder.append(255&low)}constructor(){this._bufferBuilder=new $e8379818650e2442$export$93654d4f2d6cd524,this._textEncoder=new TextEncoder}}let logDisabled_=!0,deprecationWarnings_=!0;function extractVersion(uastring,expr,pos){const match=uastring.match(expr);return match&&match.length>=pos&&parseInt(match[pos],10)}function wrapPeerConnectionEvent(window,eventNameToWrap,wrapper){if(!window.RTCPeerConnection)return;const proto=window.RTCPeerConnection.prototype,nativeAddEventListener=proto.addEventListener;proto.addEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap)return nativeAddEventListener.apply(this,arguments);const wrappedCallback=e=>{const modifiedEvent=wrapper(e);modifiedEvent&&(cb.handleEvent?cb.handleEvent(modifiedEvent):cb(modifiedEvent))};return this._eventMap=this._eventMap||{},this._eventMap[eventNameToWrap]||(this._eventMap[eventNameToWrap]=new Map),this._eventMap[eventNameToWrap].set(cb,wrappedCallback),nativeAddEventListener.apply(this,[nativeEventName,wrappedCallback])};const nativeRemoveEventListener=proto.removeEventListener;proto.removeEventListener=function(nativeEventName,cb){if(nativeEventName!==eventNameToWrap||!this._eventMap||!this._eventMap[eventNameToWrap])return nativeRemoveEventListener.apply(this,arguments);if(!this._eventMap[eventNameToWrap].has(cb))return nativeRemoveEventListener.apply(this,arguments);const unwrappedCb=this._eventMap[eventNameToWrap].get(cb);return this._eventMap[eventNameToWrap].delete(cb),0===this._eventMap[eventNameToWrap].size&&delete this._eventMap[eventNameToWrap],0===Object.keys(this._eventMap).length&&delete this._eventMap,nativeRemoveEventListener.apply(this,[nativeEventName,unwrappedCb])},Object.defineProperty(proto,"on"+eventNameToWrap,{get(){return this["_on"+eventNameToWrap]},set(cb){this["_on"+eventNameToWrap]&&(this.removeEventListener(eventNameToWrap,this["_on"+eventNameToWrap]),delete this["_on"+eventNameToWrap]),cb&&this.addEventListener(eventNameToWrap,this["_on"+eventNameToWrap]=cb)},enumerable:!0,configurable:!0})}function disableLog(bool){return"boolean"!=typeof bool?new Error("Argument type: "+typeof bool+". Please use a boolean."):(logDisabled_=bool,bool?"adapter.js logging disabled":"adapter.js logging enabled")}function disableWarnings(bool){return"boolean"!=typeof bool?new Error("Argument type: "+typeof bool+". Please use a boolean."):(deprecationWarnings_=!bool,"adapter.js deprecation warnings "+(bool?"disabled":"enabled"))}function log(){if("object"==typeof window){if(logDisabled_)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function deprecated(oldMethod,newMethod){deprecationWarnings_&&console.warn(oldMethod+" is deprecated, please use "+newMethod+" instead.")}function isObject(val){return"[object Object]"===Object.prototype.toString.call(val)}function compactObject(data){return isObject(data)?Object.keys(data).reduce((function(accumulator,key){const isObj=isObject(data[key]),value=isObj?compactObject(data[key]):data[key],isEmptyObject=isObj&&!Object.keys(value).length;return void 0===value||isEmptyObject?accumulator:Object.assign(accumulator,{[key]:value})}),{}):data}function walkStats(stats,base,resultSet){base&&!resultSet.has(base.id)&&(resultSet.set(base.id,base),Object.keys(base).forEach((name=>{name.endsWith("Id")?walkStats(stats,stats.get(base[name]),resultSet):name.endsWith("Ids")&&base[name].forEach((id=>{walkStats(stats,stats.get(id),resultSet)}))})))}function filterStats(result,track,outbound){const streamStatsType=outbound?"outbound-rtp":"inbound-rtp",filteredResult=new Map;if(null===track)return filteredResult;const trackStats=[];return result.forEach((value=>{"track"===value.type&&value.trackIdentifier===track.id&&trackStats.push(value)})),trackStats.forEach((trackStat=>{result.forEach((stats=>{stats.type===streamStatsType&&stats.trackId===trackStat.id&&walkStats(result,stats,filteredResult)}))})),filteredResult}const logging=log;function shimGetUserMedia(window,browserDetails){const navigator=window&&window.navigator;if(!navigator.mediaDevices)return;const constraintsToChrome_=function(c){if("object"!=typeof c||c.mandatory||c.optional)return c;const cc={};return Object.keys(c).forEach((key=>{if("require"===key||"advanced"===key||"mediaSource"===key)return;const r="object"==typeof c[key]?c[key]:{ideal:c[key]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const oldname_=function(prefix,name){return prefix?prefix+name.charAt(0).toUpperCase()+name.slice(1):"deviceId"===name?"sourceId":name};if(void 0!==r.ideal){cc.optional=cc.optional||[];let oc={};"number"==typeof r.ideal?(oc[oldname_("min",key)]=r.ideal,cc.optional.push(oc),oc={},oc[oldname_("max",key)]=r.ideal,cc.optional.push(oc)):(oc[oldname_("",key)]=r.ideal,cc.optional.push(oc))}void 0!==r.exact&&"number"!=typeof r.exact?(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_("",key)]=r.exact):["min","max"].forEach((mix=>{void 0!==r[mix]&&(cc.mandatory=cc.mandatory||{},cc.mandatory[oldname_(mix,key)]=r[mix])}))})),c.advanced&&(cc.optional=(cc.optional||[]).concat(c.advanced)),cc},shimConstraints_=function(constraints,func){if(browserDetails.version>=61)return func(constraints);if((constraints=JSON.parse(JSON.stringify(constraints)))&&"object"==typeof constraints.audio){const remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])};remap((constraints=JSON.parse(JSON.stringify(constraints))).audio,"autoGainControl","googAutoGainControl"),remap(constraints.audio,"noiseSuppression","googNoiseSuppression"),constraints.audio=constraintsToChrome_(constraints.audio)}if(constraints&&"object"==typeof constraints.video){let face=constraints.video.facingMode;face=face&&("object"==typeof face?face:{ideal:face});const getSupportedFacingModeLies=browserDetails.version<66;if(face&&("user"===face.exact||"environment"===face.exact||"user"===face.ideal||"environment"===face.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||getSupportedFacingModeLies)){let matches;if(delete constraints.video.facingMode,"environment"===face.exact||"environment"===face.ideal?matches=["back","rear"]:"user"!==face.exact&&"user"!==face.ideal||(matches=["front"]),matches)return navigator.mediaDevices.enumerateDevices().then((devices=>{let dev=(devices=devices.filter((d=>"videoinput"===d.kind))).find((d=>matches.some((match=>d.label.toLowerCase().includes(match)))));return!dev&&devices.length&&matches.includes("back")&&(dev=devices[devices.length-1]),dev&&(constraints.video.deviceId=face.exact?{exact:dev.deviceId}:{ideal:dev.deviceId}),constraints.video=constraintsToChrome_(constraints.video),logging("chrome: "+JSON.stringify(constraints)),func(constraints)}))}constraints.video=constraintsToChrome_(constraints.video)}return logging("chrome: "+JSON.stringify(constraints)),func(constraints)},shimError_=function(e){return browserDetails.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(navigator.getUserMedia=function(constraints,onSuccess,onError){shimConstraints_(constraints,(c=>{navigator.webkitGetUserMedia(c,onSuccess,(e=>{onError&&onError(shimError_(e))}))}))}.bind(navigator),navigator.mediaDevices.getUserMedia){const origGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(cs){return shimConstraints_(cs,(c=>origGetUserMedia(c).then((stream=>{if(c.audio&&!stream.getAudioTracks().length||c.video&&!stream.getVideoTracks().length)throw stream.getTracks().forEach((track=>{track.stop()})),new DOMException("","NotFoundError");return stream}),(e=>Promise.reject(shimError_(e))))))}}}function shimMediaStream(window){window.MediaStream=window.MediaStream||window.webkitMediaStream}function shimOnTrack(window){if("object"==typeof window&&window.RTCPeerConnection&&!("ontrack"in window.RTCPeerConnection.prototype)){Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(f){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=f)},enumerable:!0,configurable:!0});const origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",(te=>{let receiver;receiver=window.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((r=>r.track&&r.track.id===te.track.id)):{track:te.track};const event=new Event("track");event.track=te.track,event.receiver=receiver,event.transceiver={receiver},event.streams=[e.stream],this.dispatchEvent(event)})),e.stream.getTracks().forEach((track=>{let receiver;receiver=window.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((r=>r.track&&r.track.id===track.id)):{track};const event=new Event("track");event.track=track,event.receiver=receiver,event.transceiver={receiver},event.streams=[e.stream],this.dispatchEvent(event)}))},this.addEventListener("addstream",this._ontrackpoly)),origSetRemoteDescription.apply(this,arguments)}}else wrapPeerConnectionEvent(window,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function shimGetSendersWithDtmf(window){if("object"==typeof window&&window.RTCPeerConnection&&!("getSenders"in window.RTCPeerConnection.prototype)&&"createDTMFSender"in window.RTCPeerConnection.prototype){const shimSenderWithDtmf=function(pc,track){return{track,get dtmf(){return void 0===this._dtmf&&("audio"===track.kind?this._dtmf=pc.createDTMFSender(track):this._dtmf=null),this._dtmf},_pc:pc}};if(!window.RTCPeerConnection.prototype.getSenders){window.RTCPeerConnection.prototype.getSenders=function getSenders(){return this._senders=this._senders||[],this._senders.slice()};const origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function addTrack(track,stream){let sender=origAddTrack.apply(this,arguments);return sender||(sender=shimSenderWithDtmf(this,track),this._senders.push(sender)),sender};const origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function removeTrack(sender){origRemoveTrack.apply(this,arguments);const idx=this._senders.indexOf(sender);-1!==idx&&this._senders.splice(idx,1)}}const origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function addStream(stream){this._senders=this._senders||[],origAddStream.apply(this,[stream]),stream.getTracks().forEach((track=>{this._senders.push(shimSenderWithDtmf(this,track))}))};const origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function removeStream(stream){this._senders=this._senders||[],origRemoveStream.apply(this,[stream]),stream.getTracks().forEach((track=>{const sender=this._senders.find((s=>s.track===track));sender&&this._senders.splice(this._senders.indexOf(sender),1)}))}}else if("object"==typeof window&&window.RTCPeerConnection&&"getSenders"in window.RTCPeerConnection.prototype&&"createDTMFSender"in window.RTCPeerConnection.prototype&&window.RTCRtpSender&&!("dtmf"in window.RTCRtpSender.prototype)){const origGetSenders=window.RTCPeerConnection.prototype.getSenders;window.RTCPeerConnection.prototype.getSenders=function getSenders(){const senders=origGetSenders.apply(this,[]);return senders.forEach((sender=>sender._pc=this)),senders},Object.defineProperty(window.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function shimSenderReceiverGetStats(window){if(!("object"==typeof window&&window.RTCPeerConnection&&window.RTCRtpSender&&window.RTCRtpReceiver))return;if(!("getStats"in window.RTCRtpSender.prototype)){const origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function getSenders(){const senders=origGetSenders.apply(this,[]);return senders.forEach((sender=>sender._pc=this)),senders});const origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function addTrack(){const sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function getStats(){const sender=this;return this._pc.getStats().then((result=>filterStats(result,sender.track,!0)))}}if(!("getStats"in window.RTCRtpReceiver.prototype)){const origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function getReceivers(){const receivers=origGetReceivers.apply(this,[]);return receivers.forEach((receiver=>receiver._pc=this)),receivers}),wrapPeerConnectionEvent(window,"track",(e=>(e.receiver._pc=e.srcElement,e))),window.RTCRtpReceiver.prototype.getStats=function getStats(){const receiver=this;return this._pc.getStats().then((result=>filterStats(result,receiver.track,!1)))}}if(!("getStats"in window.RTCRtpSender.prototype)||!("getStats"in window.RTCRtpReceiver.prototype))return;const origGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function getStats(){if(arguments.length>0&&arguments[0]instanceof window.MediaStreamTrack){const track=arguments[0];let sender,receiver,err;return this.getSenders().forEach((s=>{s.track===track&&(sender?err=!0:sender=s)})),this.getReceivers().forEach((r=>(r.track===track&&(receiver?err=!0:receiver=r),r.track===track))),err||sender&&receiver?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):sender?sender.getStats():receiver?receiver.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return origGetStats.apply(this,arguments)}}function shimAddTrackRemoveTrackWithNative(window){window.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((streamId=>this._shimmedLocalStreams[streamId][0]))};const origAddTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addTrack=function addTrack(track,stream){if(!stream)return origAddTrack.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const sender=origAddTrack.apply(this,arguments);return this._shimmedLocalStreams[stream.id]?-1===this._shimmedLocalStreams[stream.id].indexOf(sender)&&this._shimmedLocalStreams[stream.id].push(sender):this._shimmedLocalStreams[stream.id]=[stream,sender],sender};const origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function addStream(stream){this._shimmedLocalStreams=this._shimmedLocalStreams||{},stream.getTracks().forEach((track=>{if(this.getSenders().find((s=>s.track===track)))throw new DOMException("Track already exists.","InvalidAccessError")}));const existingSenders=this.getSenders();origAddStream.apply(this,arguments);const newSenders=this.getSenders().filter((newSender=>-1===existingSenders.indexOf(newSender)));this._shimmedLocalStreams[stream.id]=[stream].concat(newSenders)};const origRemoveStream=window.RTCPeerConnection.prototype.removeStream;window.RTCPeerConnection.prototype.removeStream=function removeStream(stream){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[stream.id],origRemoveStream.apply(this,arguments)};const origRemoveTrack=window.RTCPeerConnection.prototype.removeTrack;window.RTCPeerConnection.prototype.removeTrack=function removeTrack(sender){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},sender&&Object.keys(this._shimmedLocalStreams).forEach((streamId=>{const idx=this._shimmedLocalStreams[streamId].indexOf(sender);-1!==idx&&this._shimmedLocalStreams[streamId].splice(idx,1),1===this._shimmedLocalStreams[streamId].length&&delete this._shimmedLocalStreams[streamId]})),origRemoveTrack.apply(this,arguments)}}function shimAddTrackRemoveTrack(window,browserDetails){if(!window.RTCPeerConnection)return;if(window.RTCPeerConnection.prototype.addTrack&&browserDetails.version>=65)return shimAddTrackRemoveTrackWithNative(window);const origGetLocalStreams=window.RTCPeerConnection.prototype.getLocalStreams;window.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){const nativeStreams=origGetLocalStreams.apply(this);return this._reverseStreams=this._reverseStreams||{},nativeStreams.map((stream=>this._reverseStreams[stream.id]))};const origAddStream=window.RTCPeerConnection.prototype.addStream;window.RTCPeerConnection.prototype.addStream=function addStream(stream){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},stream.getTracks().forEach((track=>{if(this.getSenders().find((s=>s.track===track)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[stream.id]){const newStream=new window.MediaStream(stream.getTracks());this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,stream=newStream}origAddStream.apply(this,[stream])};const origRemoveStream=window.RTCPeerConnection.prototype.removeStream;function replaceInternalStreamId(pc,description){let sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((internalId=>{const externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(internalStream.id,"g"),externalStream.id)})),new RTCSessionDescription({type:description.type,sdp})}window.RTCPeerConnection.prototype.removeStream=function removeStream(stream){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},origRemoveStream.apply(this,[this._streams[stream.id]||stream]),delete this._reverseStreams[this._streams[stream.id]?this._streams[stream.id].id:stream.id],delete this._streams[stream.id]},window.RTCPeerConnection.prototype.addTrack=function addTrack(track,stream){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const streams=[].slice.call(arguments,1);if(1!==streams.length||!streams[0].getTracks().find((t=>t===track)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((s=>s.track===track)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const oldStream=this._streams[stream.id];if(oldStream)oldStream.addTrack(track),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const newStream=new window.MediaStream([track]);this._streams[stream.id]=newStream,this._reverseStreams[newStream.id]=stream,this.addStream(newStream)}return this.getSenders().find((s=>s.track===track))},["createOffer","createAnswer"].forEach((function(method){const nativeMethod=window.RTCPeerConnection.prototype[method],methodObj={[method](){const args=arguments;return arguments.length&&"function"==typeof arguments[0]?nativeMethod.apply(this,[description=>{const desc=replaceInternalStreamId(this,description);args[0].apply(null,[desc])},err=>{args[1]&&args[1].apply(null,err)},arguments[2]]):nativeMethod.apply(this,arguments).then((description=>replaceInternalStreamId(this,description)))}};window.RTCPeerConnection.prototype[method]=methodObj[method]}));const origSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;window.RTCPeerConnection.prototype.setLocalDescription=function setLocalDescription(){return arguments.length&&arguments[0].type?(arguments[0]=function replaceExternalStreamId(pc,description){let sdp=description.sdp;return Object.keys(pc._reverseStreams||[]).forEach((internalId=>{const externalStream=pc._reverseStreams[internalId],internalStream=pc._streams[externalStream.id];sdp=sdp.replace(new RegExp(externalStream.id,"g"),internalStream.id)})),new RTCSessionDescription({type:description.type,sdp})}(this,arguments[0]),origSetLocalDescription.apply(this,arguments)):origSetLocalDescription.apply(this,arguments)};const origLocalDescription=Object.getOwnPropertyDescriptor(window.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(window.RTCPeerConnection.prototype,"localDescription",{get(){const description=origLocalDescription.get.apply(this);return""===description.type?description:replaceInternalStreamId(this,description)}}),window.RTCPeerConnection.prototype.removeTrack=function removeTrack(sender){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!sender._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(sender._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let stream;this._streams=this._streams||{},Object.keys(this._streams).forEach((streamid=>{this._streams[streamid].getTracks().find((track=>sender.track===track))&&(stream=this._streams[streamid])})),stream&&(1===stream.getTracks().length?this.removeStream(this._reverseStreams[stream.id]):stream.removeTrack(sender.track),this.dispatchEvent(new Event("negotiationneeded")))}}function shimPeerConnection(window,browserDetails){!window.RTCPeerConnection&&window.webkitRTCPeerConnection&&(window.RTCPeerConnection=window.webkitRTCPeerConnection),window.RTCPeerConnection&&browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){const nativeMethod=window.RTCPeerConnection.prototype[method],methodObj={[method](){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}};window.RTCPeerConnection.prototype[method]=methodObj[method]}))}function fixNegotiationNeeded(window,browserDetails){wrapPeerConnectionEvent(window,"negotiationneeded",(e=>{const pc=e.target;if(!(browserDetails.version<72||pc.getConfiguration&&"plan-b"===pc.getConfiguration().sdpSemantics)||"stable"===pc.signalingState)return e}))}function getusermedia_shimGetUserMedia(window,browserDetails){const navigator=window&&window.navigator,MediaStreamTrack=window&&window.MediaStreamTrack;if(navigator.getUserMedia=function(constraints,onSuccess,onError){deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(constraints).then(onSuccess,onError)},!(browserDetails.version>55&&"autoGainControl"in navigator.mediaDevices.getSupportedConstraints())){const remap=function(obj,a,b){a in obj&&!(b in obj)&&(obj[b]=obj[a],delete obj[a])},nativeGetUserMedia=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);if(navigator.mediaDevices.getUserMedia=function(c){return"object"==typeof c&&"object"==typeof c.audio&&(c=JSON.parse(JSON.stringify(c)),remap(c.audio,"autoGainControl","mozAutoGainControl"),remap(c.audio,"noiseSuppression","mozNoiseSuppression")),nativeGetUserMedia(c)},MediaStreamTrack&&MediaStreamTrack.prototype.getSettings){const nativeGetSettings=MediaStreamTrack.prototype.getSettings;MediaStreamTrack.prototype.getSettings=function(){const obj=nativeGetSettings.apply(this,arguments);return remap(obj,"mozAutoGainControl","autoGainControl"),remap(obj,"mozNoiseSuppression","noiseSuppression"),obj}}if(MediaStreamTrack&&MediaStreamTrack.prototype.applyConstraints){const nativeApplyConstraints=MediaStreamTrack.prototype.applyConstraints;MediaStreamTrack.prototype.applyConstraints=function(c){return"audio"===this.kind&&"object"==typeof c&&(c=JSON.parse(JSON.stringify(c)),remap(c,"autoGainControl","mozAutoGainControl"),remap(c,"noiseSuppression","mozNoiseSuppression")),nativeApplyConstraints.apply(this,[c])}}}}function shimGetDisplayMedia(window,preferredMediaSource){window.navigator.mediaDevices&&"getDisplayMedia"in window.navigator.mediaDevices||window.navigator.mediaDevices&&(window.navigator.mediaDevices.getDisplayMedia=function getDisplayMedia(constraints){if(!constraints||!constraints.video){const err=new DOMException("getDisplayMedia without video constraints is undefined");return err.name="NotFoundError",err.code=8,Promise.reject(err)}return!0===constraints.video?constraints.video={mediaSource:preferredMediaSource}:constraints.video.mediaSource=preferredMediaSource,window.navigator.mediaDevices.getUserMedia(constraints)})}function firefox_shim_shimOnTrack(window){"object"==typeof window&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function firefox_shim_shimPeerConnection(window,browserDetails){if("object"!=typeof window||!window.RTCPeerConnection&&!window.mozRTCPeerConnection)return;!window.RTCPeerConnection&&window.mozRTCPeerConnection&&(window.RTCPeerConnection=window.mozRTCPeerConnection),browserDetails.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(method){const nativeMethod=window.RTCPeerConnection.prototype[method],methodObj={[method](){return arguments[0]=new("addIceCandidate"===method?window.RTCIceCandidate:window.RTCSessionDescription)(arguments[0]),nativeMethod.apply(this,arguments)}};window.RTCPeerConnection.prototype[method]=methodObj[method]}));const modernStatsTypes={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},nativeGetStats=window.RTCPeerConnection.prototype.getStats;window.RTCPeerConnection.prototype.getStats=function getStats(){const[selector,onSucc,onErr]=arguments;return nativeGetStats.apply(this,[selector||null]).then((stats=>{if(browserDetails.version<53&&!onSucc)try{stats.forEach((stat=>{stat.type=modernStatsTypes[stat.type]||stat.type}))}catch(e){if("TypeError"!==e.name)throw e;stats.forEach(((stat,i)=>{stats.set(i,Object.assign({},stat,{type:modernStatsTypes[stat.type]||stat.type}))}))}return stats})).then(onSucc,onErr)}}function shimSenderGetStats(window){if("object"!=typeof window||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpSender.prototype)return;const origGetSenders=window.RTCPeerConnection.prototype.getSenders;origGetSenders&&(window.RTCPeerConnection.prototype.getSenders=function getSenders(){const senders=origGetSenders.apply(this,[]);return senders.forEach((sender=>sender._pc=this)),senders});const origAddTrack=window.RTCPeerConnection.prototype.addTrack;origAddTrack&&(window.RTCPeerConnection.prototype.addTrack=function addTrack(){const sender=origAddTrack.apply(this,arguments);return sender._pc=this,sender}),window.RTCRtpSender.prototype.getStats=function getStats(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function shimReceiverGetStats(window){if("object"!=typeof window||!window.RTCPeerConnection||!window.RTCRtpSender)return;if(window.RTCRtpSender&&"getStats"in window.RTCRtpReceiver.prototype)return;const origGetReceivers=window.RTCPeerConnection.prototype.getReceivers;origGetReceivers&&(window.RTCPeerConnection.prototype.getReceivers=function getReceivers(){const receivers=origGetReceivers.apply(this,[]);return receivers.forEach((receiver=>receiver._pc=this)),receivers}),wrapPeerConnectionEvent(window,"track",(e=>(e.receiver._pc=e.srcElement,e))),window.RTCRtpReceiver.prototype.getStats=function getStats(){return this._pc.getStats(this.track)}}function shimRemoveStream(window){window.RTCPeerConnection&&!("removeStream"in window.RTCPeerConnection.prototype)&&(window.RTCPeerConnection.prototype.removeStream=function removeStream(stream){deprecated("removeStream","removeTrack"),this.getSenders().forEach((sender=>{sender.track&&stream.getTracks().includes(sender.track)&&this.removeTrack(sender)}))})}function shimRTCDataChannel(window){window.DataChannel&&!window.RTCDataChannel&&(window.RTCDataChannel=window.DataChannel)}function shimAddTransceiver(window){if("object"!=typeof window||!window.RTCPeerConnection)return;const origAddTransceiver=window.RTCPeerConnection.prototype.addTransceiver;origAddTransceiver&&(window.RTCPeerConnection.prototype.addTransceiver=function addTransceiver(){this.setParametersPromises=[];let sendEncodings=arguments[1]&&arguments[1].sendEncodings;void 0===sendEncodings&&(sendEncodings=[]),sendEncodings=[...sendEncodings];const shouldPerformCheck=sendEncodings.length>0;shouldPerformCheck&&sendEncodings.forEach((encodingParam=>{if("rid"in encodingParam){if(!/^[a-z0-9]{0,16}$/i.test(encodingParam.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in encodingParam&&!(parseFloat(encodingParam.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in encodingParam&&!(parseFloat(encodingParam.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const transceiver=origAddTransceiver.apply(this,arguments);if(shouldPerformCheck){const{sender}=transceiver,params=sender.getParameters();(!("encodings"in params)||1===params.encodings.length&&0===Object.keys(params.encodings[0]).length)&&(params.encodings=sendEncodings,sender.sendEncodings=sendEncodings,this.setParametersPromises.push(sender.setParameters(params).then((()=>{delete sender.sendEncodings})).catch((()=>{delete sender.sendEncodings}))))}return transceiver})}function shimGetParameters(window){if("object"!=typeof window||!window.RTCRtpSender)return;const origGetParameters=window.RTCRtpSender.prototype.getParameters;origGetParameters&&(window.RTCRtpSender.prototype.getParameters=function getParameters(){const params=origGetParameters.apply(this,arguments);return"encodings"in params||(params.encodings=[].concat(this.sendEncodings||[{}])),params})}function shimCreateOffer(window){if("object"!=typeof window||!window.RTCPeerConnection)return;const origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function createOffer(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>origCreateOffer.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):origCreateOffer.apply(this,arguments)}}function shimCreateAnswer(window){if("object"!=typeof window||!window.RTCPeerConnection)return;const origCreateAnswer=window.RTCPeerConnection.prototype.createAnswer;window.RTCPeerConnection.prototype.createAnswer=function createAnswer(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>origCreateAnswer.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):origCreateAnswer.apply(this,arguments)}}function shimLocalStreamsAPI(window){if("object"==typeof window&&window.RTCPeerConnection){if("getLocalStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getLocalStreams=function getLocalStreams(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in window.RTCPeerConnection.prototype)){const _addTrack=window.RTCPeerConnection.prototype.addTrack;window.RTCPeerConnection.prototype.addStream=function addStream(stream){this._localStreams||(this._localStreams=[]),this._localStreams.includes(stream)||this._localStreams.push(stream),stream.getAudioTracks().forEach((track=>_addTrack.call(this,track,stream))),stream.getVideoTracks().forEach((track=>_addTrack.call(this,track,stream)))},window.RTCPeerConnection.prototype.addTrack=function addTrack(track,...streams){return streams&&streams.forEach((stream=>{this._localStreams?this._localStreams.includes(stream)||this._localStreams.push(stream):this._localStreams=[stream]})),_addTrack.apply(this,arguments)}}"removeStream"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.removeStream=function removeStream(stream){this._localStreams||(this._localStreams=[]);const index=this._localStreams.indexOf(stream);if(-1===index)return;this._localStreams.splice(index,1);const tracks=stream.getTracks();this.getSenders().forEach((sender=>{tracks.includes(sender.track)&&this.removeTrack(sender)}))})}}function shimRemoteStreamsAPI(window){if("object"==typeof window&&window.RTCPeerConnection&&("getRemoteStreams"in window.RTCPeerConnection.prototype||(window.RTCPeerConnection.prototype.getRemoteStreams=function getRemoteStreams(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in window.RTCPeerConnection.prototype))){Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(f){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=f),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((stream=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(stream))return;this._remoteStreams.push(stream);const event=new Event("addstream");event.stream=stream,this.dispatchEvent(event)}))})}});const origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){const pc=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((stream=>{if(pc._remoteStreams||(pc._remoteStreams=[]),pc._remoteStreams.indexOf(stream)>=0)return;pc._remoteStreams.push(stream);const event=new Event("addstream");event.stream=stream,pc.dispatchEvent(event)}))}),origSetRemoteDescription.apply(pc,arguments)}}}function shimCallbacksAPI(window){if("object"!=typeof window||!window.RTCPeerConnection)return;const prototype=window.RTCPeerConnection.prototype,origCreateOffer=prototype.createOffer,origCreateAnswer=prototype.createAnswer,setLocalDescription=prototype.setLocalDescription,setRemoteDescription=prototype.setRemoteDescription,addIceCandidate=prototype.addIceCandidate;prototype.createOffer=function createOffer(successCallback,failureCallback){const options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateOffer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.createAnswer=function createAnswer(successCallback,failureCallback){const options=arguments.length>=2?arguments[2]:arguments[0],promise=origCreateAnswer.apply(this,[options]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};let withCallback=function(description,successCallback,failureCallback){const promise=setLocalDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise};prototype.setLocalDescription=withCallback,withCallback=function(description,successCallback,failureCallback){const promise=setRemoteDescription.apply(this,[description]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.setRemoteDescription=withCallback,withCallback=function(candidate,successCallback,failureCallback){const promise=addIceCandidate.apply(this,[candidate]);return failureCallback?(promise.then(successCallback,failureCallback),Promise.resolve()):promise},prototype.addIceCandidate=withCallback}function safari_shim_shimGetUserMedia(window){const navigator=window&&window.navigator;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const mediaDevices=navigator.mediaDevices,_getUserMedia=mediaDevices.getUserMedia.bind(mediaDevices);navigator.mediaDevices.getUserMedia=constraints=>_getUserMedia(shimConstraints(constraints))}!navigator.getUserMedia&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function getUserMedia(constraints,cb,errcb){navigator.mediaDevices.getUserMedia(constraints).then(cb,errcb)}.bind(navigator))}function shimConstraints(constraints){return constraints&&void 0!==constraints.video?Object.assign({},constraints,{video:compactObject(constraints.video)}):constraints}function shimRTCIceServerUrls(window){if(!window.RTCPeerConnection)return;const OrigPeerConnection=window.RTCPeerConnection;window.RTCPeerConnection=function RTCPeerConnection(pcConfig,pcConstraints){if(pcConfig&&pcConfig.iceServers){const newIceServers=[];for(let i=0;i<pcConfig.iceServers.length;i++){let server=pcConfig.iceServers[i];void 0===server.urls&&server.url?(deprecated("RTCIceServer.url","RTCIceServer.urls"),server=JSON.parse(JSON.stringify(server)),server.urls=server.url,delete server.url,newIceServers.push(server)):newIceServers.push(pcConfig.iceServers[i])}pcConfig.iceServers=newIceServers}return new OrigPeerConnection(pcConfig,pcConstraints)},window.RTCPeerConnection.prototype=OrigPeerConnection.prototype,"generateCertificate"in OrigPeerConnection&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:()=>OrigPeerConnection.generateCertificate})}function shimTrackEventTransceiver(window){"object"==typeof window&&window.RTCTrackEvent&&"receiver"in window.RTCTrackEvent.prototype&&!("transceiver"in window.RTCTrackEvent.prototype)&&Object.defineProperty(window.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function shimCreateOfferLegacy(window){const origCreateOffer=window.RTCPeerConnection.prototype.createOffer;window.RTCPeerConnection.prototype.createOffer=function createOffer(offerOptions){if(offerOptions){void 0!==offerOptions.offerToReceiveAudio&&(offerOptions.offerToReceiveAudio=!!offerOptions.offerToReceiveAudio);const audioTransceiver=this.getTransceivers().find((transceiver=>"audio"===transceiver.receiver.track.kind));!1===offerOptions.offerToReceiveAudio&&audioTransceiver?"sendrecv"===audioTransceiver.direction?audioTransceiver.setDirection?audioTransceiver.setDirection("sendonly"):audioTransceiver.direction="sendonly":"recvonly"===audioTransceiver.direction&&(audioTransceiver.setDirection?audioTransceiver.setDirection("inactive"):audioTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveAudio||audioTransceiver||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==offerOptions.offerToReceiveVideo&&(offerOptions.offerToReceiveVideo=!!offerOptions.offerToReceiveVideo);const videoTransceiver=this.getTransceivers().find((transceiver=>"video"===transceiver.receiver.track.kind));!1===offerOptions.offerToReceiveVideo&&videoTransceiver?"sendrecv"===videoTransceiver.direction?videoTransceiver.setDirection?videoTransceiver.setDirection("sendonly"):videoTransceiver.direction="sendonly":"recvonly"===videoTransceiver.direction&&(videoTransceiver.setDirection?videoTransceiver.setDirection("inactive"):videoTransceiver.direction="inactive"):!0!==offerOptions.offerToReceiveVideo||videoTransceiver||this.addTransceiver("video",{direction:"recvonly"})}return origCreateOffer.apply(this,arguments)}}function shimAudioContext(window){"object"!=typeof window||window.AudioContext||(window.AudioContext=window.webkitAudioContext)}var sdp=__webpack_require__("./node_modules/sdp/sdp.js"),sdp_default=__webpack_require__.n(sdp);function shimRTCIceCandidate(window){if(!window.RTCIceCandidate||window.RTCIceCandidate&&"foundation"in window.RTCIceCandidate.prototype)return;const NativeRTCIceCandidate=window.RTCIceCandidate;window.RTCIceCandidate=function RTCIceCandidate(args){if("object"==typeof args&&args.candidate&&0===args.candidate.indexOf("a=")&&((args=JSON.parse(JSON.stringify(args))).candidate=args.candidate.substring(2)),args.candidate&&args.candidate.length){const nativeCandidate=new NativeRTCIceCandidate(args),parsedCandidate=sdp_default().parseCandidate(args.candidate);for(const key in parsedCandidate)key in nativeCandidate||Object.defineProperty(nativeCandidate,key,{value:parsedCandidate[key]});return nativeCandidate.toJSON=function toJSON(){return{candidate:nativeCandidate.candidate,sdpMid:nativeCandidate.sdpMid,sdpMLineIndex:nativeCandidate.sdpMLineIndex,usernameFragment:nativeCandidate.usernameFragment}},nativeCandidate}return new NativeRTCIceCandidate(args)},window.RTCIceCandidate.prototype=NativeRTCIceCandidate.prototype,wrapPeerConnectionEvent(window,"icecandidate",(e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new window.RTCIceCandidate(e.candidate),writable:"false"}),e)))}function shimRTCIceCandidateRelayProtocol(window){!window.RTCIceCandidate||window.RTCIceCandidate&&"relayProtocol"in window.RTCIceCandidate.prototype||wrapPeerConnectionEvent(window,"icecandidate",(e=>{if(e.candidate){const parsedCandidate=sdp_default().parseCandidate(e.candidate.candidate);"relay"===parsedCandidate.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[parsedCandidate.priority>>24])}return e}))}function shimMaxMessageSize(window,browserDetails){if(!window.RTCPeerConnection)return;"sctp"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const origSetRemoteDescription=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(){if(this._sctp=null,"chrome"===browserDetails.browser&&browserDetails.version>=76){const{sdpSemantics}=this.getConfiguration();"plan-b"===sdpSemantics&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(description){if(!description||!description.sdp)return!1;const sections=sdp_default().splitSections(description.sdp);return sections.shift(),sections.some((mediaSection=>{const mLine=sdp_default().parseMLine(mediaSection);return mLine&&"application"===mLine.kind&&-1!==mLine.protocol.indexOf("SCTP")}))}(arguments[0])){const isFirefox=function(description){const match=description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===match||match.length<2)return-1;const version=parseInt(match[1],10);return version!=version?-1:version}(arguments[0]),canSendMMS=function(remoteIsFirefox){let canSendMaxMessageSize=65536;return"firefox"===browserDetails.browser&&(canSendMaxMessageSize=browserDetails.version<57?-1===remoteIsFirefox?16384:2147483637:browserDetails.version<60?57===browserDetails.version?65535:65536:2147483637),canSendMaxMessageSize}(isFirefox),remoteMMS=function(description,remoteIsFirefox){let maxMessageSize=65536;"firefox"===browserDetails.browser&&57===browserDetails.version&&(maxMessageSize=65535);const match=sdp_default().matchPrefix(description.sdp,"a=max-message-size:");return match.length>0?maxMessageSize=parseInt(match[0].substring(19),10):"firefox"===browserDetails.browser&&-1!==remoteIsFirefox&&(maxMessageSize=2147483637),maxMessageSize}(arguments[0],isFirefox);let maxMessageSize;maxMessageSize=0===canSendMMS&&0===remoteMMS?Number.POSITIVE_INFINITY:0===canSendMMS||0===remoteMMS?Math.max(canSendMMS,remoteMMS):Math.min(canSendMMS,remoteMMS);const sctp={};Object.defineProperty(sctp,"maxMessageSize",{get:()=>maxMessageSize}),this._sctp=sctp}return origSetRemoteDescription.apply(this,arguments)}}function shimSendThrowTypeError(window){if(!window.RTCPeerConnection||!("createDataChannel"in window.RTCPeerConnection.prototype))return;function wrapDcSend(dc,pc){const origDataChannelSend=dc.send;dc.send=function send(){const data=arguments[0],length=data.length||data.size||data.byteLength;if("open"===dc.readyState&&pc.sctp&&length>pc.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+pc.sctp.maxMessageSize+" bytes)");return origDataChannelSend.apply(dc,arguments)}}const origCreateDataChannel=window.RTCPeerConnection.prototype.createDataChannel;window.RTCPeerConnection.prototype.createDataChannel=function createDataChannel(){const dataChannel=origCreateDataChannel.apply(this,arguments);return wrapDcSend(dataChannel,this),dataChannel},wrapPeerConnectionEvent(window,"datachannel",(e=>(wrapDcSend(e.channel,e.target),e)))}function shimConnectionState(window){if(!window.RTCPeerConnection||"connectionState"in window.RTCPeerConnection.prototype)return;const proto=window.RTCPeerConnection.prototype;Object.defineProperty(proto,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(proto,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(cb){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),cb&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=cb)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((method=>{const origMethod=proto[method];proto[method]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const pc=e.target;if(pc._lastConnectionState!==pc.connectionState){pc._lastConnectionState=pc.connectionState;const newEvent=new Event("connectionstatechange",e);pc.dispatchEvent(newEvent)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),origMethod.apply(this,arguments)}}))}function removeExtmapAllowMixed(window,browserDetails){if(!window.RTCPeerConnection)return;if("chrome"===browserDetails.browser&&browserDetails.version>=71)return;if("safari"===browserDetails.browser&&browserDetails.version>=605)return;const nativeSRD=window.RTCPeerConnection.prototype.setRemoteDescription;window.RTCPeerConnection.prototype.setRemoteDescription=function setRemoteDescription(desc){if(desc&&desc.sdp&&-1!==desc.sdp.indexOf("\na=extmap-allow-mixed")){const sdp=desc.sdp.split("\n").filter((line=>"a=extmap-allow-mixed"!==line.trim())).join("\n");window.RTCSessionDescription&&desc instanceof window.RTCSessionDescription?arguments[0]=new window.RTCSessionDescription({type:desc.type,sdp}):desc.sdp=sdp}return nativeSRD.apply(this,arguments)}}function shimAddIceCandidateNullOrEmpty(window,browserDetails){if(!window.RTCPeerConnection||!window.RTCPeerConnection.prototype)return;const nativeAddIceCandidate=window.RTCPeerConnection.prototype.addIceCandidate;nativeAddIceCandidate&&0!==nativeAddIceCandidate.length&&(window.RTCPeerConnection.prototype.addIceCandidate=function addIceCandidate(){return arguments[0]?("chrome"===browserDetails.browser&&browserDetails.version<78||"firefox"===browserDetails.browser&&browserDetails.version<68||"safari"===browserDetails.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():nativeAddIceCandidate.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function shimParameterlessSetLocalDescription(window,browserDetails){if(!window.RTCPeerConnection||!window.RTCPeerConnection.prototype)return;const nativeSetLocalDescription=window.RTCPeerConnection.prototype.setLocalDescription;nativeSetLocalDescription&&0!==nativeSetLocalDescription.length&&(window.RTCPeerConnection.prototype.setLocalDescription=function setLocalDescription(){let desc=arguments[0]||{};if("object"!=typeof desc||desc.type&&desc.sdp)return nativeSetLocalDescription.apply(this,arguments);if(desc={type:desc.type,sdp:desc.sdp},!desc.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":desc.type="offer";break;default:desc.type="answer"}if(desc.sdp||"offer"!==desc.type&&"answer"!==desc.type)return nativeSetLocalDescription.apply(this,[desc]);return("offer"===desc.type?this.createOffer:this.createAnswer).apply(this).then((d=>nativeSetLocalDescription.apply(this,[d])))})}const adapter=function adapterFactory({window}={},options={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const logging=log,browserDetails=function detectBrowser(window){const result={browser:null,version:null};if(void 0===window||!window.navigator||!window.navigator.userAgent)return result.browser="Not a browser.",result;const{navigator}=window;if(navigator.userAgentData&&navigator.userAgentData.brands){const chromium=navigator.userAgentData.brands.find((brand=>"Chromium"===brand.brand));if(chromium)return{browser:"chrome",version:parseInt(chromium.version,10)}}if(navigator.mozGetUserMedia)result.browser="firefox",result.version=extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection)result.browser="chrome",result.version=extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!window.RTCPeerConnection||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return result.browser="Not a supported browser.",result;result.browser="safari",result.version=extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),result.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return result}(window),adapter={browserDetails,commonShim:common_shim_namespaceObject,extractVersion,disableLog,disableWarnings,sdp};switch(browserDetails.browser){case"chrome":if(!chrome_shim_namespaceObject||!shimPeerConnection||!options.shimChrome)return logging("Chrome shim is not included in this adapter release."),adapter;if(null===browserDetails.version)return logging("Chrome shim can not determine version, not shimming."),adapter;logging("adapter.js shimming chrome."),adapter.browserShim=chrome_shim_namespaceObject,shimAddIceCandidateNullOrEmpty(window,browserDetails),shimParameterlessSetLocalDescription(window),shimGetUserMedia(window,browserDetails),shimMediaStream(window),shimPeerConnection(window,browserDetails),shimOnTrack(window),shimAddTrackRemoveTrack(window,browserDetails),shimGetSendersWithDtmf(window),shimSenderReceiverGetStats(window),fixNegotiationNeeded(window,browserDetails),shimRTCIceCandidate(window),shimRTCIceCandidateRelayProtocol(window),shimConnectionState(window),shimMaxMessageSize(window,browserDetails),shimSendThrowTypeError(window),removeExtmapAllowMixed(window,browserDetails);break;case"firefox":if(!firefox_shim_namespaceObject||!firefox_shim_shimPeerConnection||!options.shimFirefox)return logging("Firefox shim is not included in this adapter release."),adapter;logging("adapter.js shimming firefox."),adapter.browserShim=firefox_shim_namespaceObject,shimAddIceCandidateNullOrEmpty(window,browserDetails),shimParameterlessSetLocalDescription(window),getusermedia_shimGetUserMedia(window,browserDetails),firefox_shim_shimPeerConnection(window,browserDetails),firefox_shim_shimOnTrack(window),shimRemoveStream(window),shimSenderGetStats(window),shimReceiverGetStats(window),shimRTCDataChannel(window),shimAddTransceiver(window),shimGetParameters(window),shimCreateOffer(window),shimCreateAnswer(window),shimRTCIceCandidate(window),shimConnectionState(window),shimMaxMessageSize(window,browserDetails),shimSendThrowTypeError(window);break;case"safari":if(!safari_shim_namespaceObject||!options.shimSafari)return logging("Safari shim is not included in this adapter release."),adapter;logging("adapter.js shimming safari."),adapter.browserShim=safari_shim_namespaceObject,shimAddIceCandidateNullOrEmpty(window,browserDetails),shimParameterlessSetLocalDescription(window),shimRTCIceServerUrls(window),shimCreateOfferLegacy(window),shimCallbacksAPI(window),shimLocalStreamsAPI(window),shimRemoteStreamsAPI(window),shimTrackEventTransceiver(window),safari_shim_shimGetUserMedia(window),shimAudioContext(window),shimRTCIceCandidate(window),shimRTCIceCandidateRelayProtocol(window),shimMaxMessageSize(window,browserDetails),shimSendThrowTypeError(window),removeExtmapAllowMixed(window,browserDetails);break;default:logging("Unsupported browser!")}return adapter}({window:"undefined"==typeof window?void 0:window}),adapter_core=adapter;function setInt64(view,offset,value){var high=Math.floor(value/4294967296),low=value;view.setUint32(offset,high),view.setUint32(offset+4,low)}function getInt64(view,offset){return 4294967296*view.getInt32(offset)+view.getUint32(offset+4)}var _a,_b,_c,process=__webpack_require__("./node_modules/process/browser.js"),TEXT_ENCODING_AVAILABLE=(void 0===process||"never"!==(null===(_a=null==process?void 0:process.env)||void 0===_a?void 0:_a.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function utf8Count(str){for(var strLength=str.length,byteLength=0,pos=0;pos<strLength;){var value=str.charCodeAt(pos++);if(0!=(4294967168&value))if(0==(4294965248&value))byteLength+=2;else{if(value>=55296&&value<=56319&&pos<strLength){var extra=str.charCodeAt(pos);56320==(64512&extra)&&(++pos,value=((1023&value)<<10)+(1023&extra)+65536)}byteLength+=0==(4294901760&value)?3:4}else byteLength++}return byteLength}var sharedTextEncoder=TEXT_ENCODING_AVAILABLE?new TextEncoder:void 0,TEXT_ENCODER_THRESHOLD=TEXT_ENCODING_AVAILABLE?void 0!==process&&"force"!==(null===(_b=null==process?void 0:process.env)||void 0===_b?void 0:_b.TEXT_ENCODING)?200:0:4294967295;var utf8EncodeTE=(null==sharedTextEncoder?void 0:sharedTextEncoder.encodeInto)?function utf8EncodeTEencodeInto(str,output,outputOffset){sharedTextEncoder.encodeInto(str,output.subarray(outputOffset))}:function utf8EncodeTEencode(str,output,outputOffset){output.set(sharedTextEncoder.encode(str),outputOffset)};function utf8DecodeJs(bytes,inputOffset,byteLength){for(var offset=inputOffset,end=offset+byteLength,units=[],result="";offset<end;){var byte1=bytes[offset++];if(0==(128&byte1))units.push(byte1);else if(192==(224&byte1)){var byte2=63&bytes[offset++];units.push((31&byte1)<<6|byte2)}else if(224==(240&byte1)){byte2=63&bytes[offset++];var byte3=63&bytes[offset++];units.push((31&byte1)<<12|byte2<<6|byte3)}else if(240==(248&byte1)){var unit=(7&byte1)<<18|(byte2=63&bytes[offset++])<<12|(byte3=63&bytes[offset++])<<6|63&bytes[offset++];unit>65535&&(unit-=65536,units.push(unit>>>10&1023|55296),unit=56320|1023&unit),units.push(unit)}else units.push(byte1);units.length>=4096&&(result+=String.fromCharCode.apply(String,units),units.length=0)}return units.length>0&&(result+=String.fromCharCode.apply(String,units)),result}var sharedTextDecoder=TEXT_ENCODING_AVAILABLE?new TextDecoder:null,TEXT_DECODER_THRESHOLD=TEXT_ENCODING_AVAILABLE?void 0!==process&&"force"!==(null===(_c=null==process?void 0:process.env)||void 0===_c?void 0:_c.TEXT_DECODER)?200:0:4294967295;var extendStatics,ExtData=function ExtData(type,data){this.type=type,this.data=data},__extends=(extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),DecodeError=function(_super){function DecodeError(message){var _this=_super.call(this,message)||this,proto=Object.create(DecodeError.prototype);return Object.setPrototypeOf(_this,proto),Object.defineProperty(_this,"name",{configurable:!0,enumerable:!1,value:DecodeError.name}),_this}return __extends(DecodeError,_super),DecodeError}(Error),TIMESTAMP32_MAX_SEC=4294967295,TIMESTAMP64_MAX_SEC=17179869183;var timestampExtension={type:-1,encode:function encodeTimestampExtension(object){return object instanceof Date?function encodeTimeSpecToTimestamp(_a){var view,sec=_a.sec,nsec=_a.nsec;if(sec>=0&&nsec>=0&&sec<=TIMESTAMP64_MAX_SEC){if(0===nsec&&sec<=TIMESTAMP32_MAX_SEC){var rv=new Uint8Array(4);return(view=new DataView(rv.buffer)).setUint32(0,sec),rv}var secHigh=sec/4294967296,secLow=4294967295&sec;return rv=new Uint8Array(8),(view=new DataView(rv.buffer)).setUint32(0,nsec<<2|3&secHigh),view.setUint32(4,secLow),rv}return rv=new Uint8Array(12),(view=new DataView(rv.buffer)).setUint32(0,nsec),setInt64(view,4,sec),rv}(function encodeDateToTimeSpec(date){var msec=date.getTime(),sec=Math.floor(msec/1e3),nsec=1e6*(msec-1e3*sec),nsecInSec=Math.floor(nsec/1e9);return{sec:sec+nsecInSec,nsec:nsec-1e9*nsecInSec}}(object)):null},decode:function decodeTimestampExtension(data){var timeSpec=function decodeTimestampToTimeSpec(data){var view=new DataView(data.buffer,data.byteOffset,data.byteLength);switch(data.byteLength){case 4:return{sec:view.getUint32(0),nsec:0};case 8:var nsec30AndSecHigh2=view.getUint32(0);return{sec:4294967296*(3&nsec30AndSecHigh2)+view.getUint32(4),nsec:nsec30AndSecHigh2>>>2};case 12:return{sec:getInt64(view,4),nsec:view.getUint32(0)};default:throw new DecodeError("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(data.length))}}(data);return new Date(1e3*timeSpec.sec+timeSpec.nsec/1e6)}},ExtensionCodec=function(){function ExtensionCodec(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(timestampExtension)}return ExtensionCodec.prototype.register=function(_a){var type=_a.type,encode=_a.encode,decode=_a.decode;if(type>=0)this.encoders[type]=encode,this.decoders[type]=decode;else{var index=1+type;this.builtInEncoders[index]=encode,this.builtInDecoders[index]=decode}},ExtensionCodec.prototype.tryToEncode=function(object,context){for(var i=0;i<this.builtInEncoders.length;i++){if(null!=(encodeExt=this.builtInEncoders[i]))if(null!=(data=encodeExt(object,context)))return new ExtData(-1-i,data)}for(i=0;i<this.encoders.length;i++){var encodeExt,data;if(null!=(encodeExt=this.encoders[i]))if(null!=(data=encodeExt(object,context)))return new ExtData(i,data)}return object instanceof ExtData?object:null},ExtensionCodec.prototype.decode=function(data,type,context){var decodeExt=type<0?this.builtInDecoders[-1-type]:this.decoders[type];return decodeExt?decodeExt(data,type,context):new ExtData(type,data)},ExtensionCodec.defaultCodec=new ExtensionCodec,ExtensionCodec}();function ensureUint8Array(buffer){return buffer instanceof Uint8Array?buffer:ArrayBuffer.isView(buffer)?new Uint8Array(buffer.buffer,buffer.byteOffset,buffer.byteLength):buffer instanceof ArrayBuffer?new Uint8Array(buffer):Uint8Array.from(buffer)}!function(){function Encoder(extensionCodec,context,maxDepth,initialBufferSize,sortKeys,forceFloat32,ignoreUndefined,forceIntegerToFloat){void 0===extensionCodec&&(extensionCodec=ExtensionCodec.defaultCodec),void 0===context&&(context=void 0),void 0===maxDepth&&(maxDepth=100),void 0===initialBufferSize&&(initialBufferSize=2048),void 0===sortKeys&&(sortKeys=!1),void 0===forceFloat32&&(forceFloat32=!1),void 0===ignoreUndefined&&(ignoreUndefined=!1),void 0===forceIntegerToFloat&&(forceIntegerToFloat=!1),this.extensionCodec=extensionCodec,this.context=context,this.maxDepth=maxDepth,this.initialBufferSize=initialBufferSize,this.sortKeys=sortKeys,this.forceFloat32=forceFloat32,this.ignoreUndefined=ignoreUndefined,this.forceIntegerToFloat=forceIntegerToFloat,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}Encoder.prototype.reinitializeState=function(){this.pos=0},Encoder.prototype.encodeSharedRef=function(object){return this.reinitializeState(),this.doEncode(object,1),this.bytes.subarray(0,this.pos)},Encoder.prototype.encode=function(object){return this.reinitializeState(),this.doEncode(object,1),this.bytes.slice(0,this.pos)},Encoder.prototype.doEncode=function(object,depth){if(depth>this.maxDepth)throw new Error("Too deep objects in depth ".concat(depth));null==object?this.encodeNil():"boolean"==typeof object?this.encodeBoolean(object):"number"==typeof object?this.encodeNumber(object):"string"==typeof object?this.encodeString(object):this.encodeObject(object,depth)},Encoder.prototype.ensureBufferSizeToWrite=function(sizeToWrite){var requiredSize=this.pos+sizeToWrite;this.view.byteLength<requiredSize&&this.resizeBuffer(2*requiredSize)},Encoder.prototype.resizeBuffer=function(newSize){var newBuffer=new ArrayBuffer(newSize),newBytes=new Uint8Array(newBuffer),newView=new DataView(newBuffer);newBytes.set(this.bytes),this.view=newView,this.bytes=newBytes},Encoder.prototype.encodeNil=function(){this.writeU8(192)},Encoder.prototype.encodeBoolean=function(object){!1===object?this.writeU8(194):this.writeU8(195)},Encoder.prototype.encodeNumber=function(object){Number.isSafeInteger(object)&&!this.forceIntegerToFloat?object>=0?object<128?this.writeU8(object):object<256?(this.writeU8(204),this.writeU8(object)):object<65536?(this.writeU8(205),this.writeU16(object)):object<4294967296?(this.writeU8(206),this.writeU32(object)):(this.writeU8(207),this.writeU64(object)):object>=-32?this.writeU8(224|object+32):object>=-128?(this.writeU8(208),this.writeI8(object)):object>=-32768?(this.writeU8(209),this.writeI16(object)):object>=-2147483648?(this.writeU8(210),this.writeI32(object)):(this.writeU8(211),this.writeI64(object)):this.forceFloat32?(this.writeU8(202),this.writeF32(object)):(this.writeU8(203),this.writeF64(object))},Encoder.prototype.writeStringHeader=function(byteLength){if(byteLength<32)this.writeU8(160+byteLength);else if(byteLength<256)this.writeU8(217),this.writeU8(byteLength);else if(byteLength<65536)this.writeU8(218),this.writeU16(byteLength);else{if(!(byteLength<4294967296))throw new Error("Too long string: ".concat(byteLength," bytes in UTF-8"));this.writeU8(219),this.writeU32(byteLength)}},Encoder.prototype.encodeString=function(object){if(object.length>TEXT_ENCODER_THRESHOLD){var byteLength=utf8Count(object);this.ensureBufferSizeToWrite(5+byteLength),this.writeStringHeader(byteLength),utf8EncodeTE(object,this.bytes,this.pos),this.pos+=byteLength}else{byteLength=utf8Count(object);this.ensureBufferSizeToWrite(5+byteLength),this.writeStringHeader(byteLength),function utf8EncodeJs(str,output,outputOffset){for(var strLength=str.length,offset=outputOffset,pos=0;pos<strLength;){var value=str.charCodeAt(pos++);if(0!=(4294967168&value)){if(0==(4294965248&value))output[offset++]=value>>6&31|192;else{if(value>=55296&&value<=56319&&pos<strLength){var extra=str.charCodeAt(pos);56320==(64512&extra)&&(++pos,value=((1023&value)<<10)+(1023&extra)+65536)}0==(4294901760&value)?(output[offset++]=value>>12&15|224,output[offset++]=value>>6&63|128):(output[offset++]=value>>18&7|240,output[offset++]=value>>12&63|128,output[offset++]=value>>6&63|128)}output[offset++]=63&value|128}else output[offset++]=value}}(object,this.bytes,this.pos),this.pos+=byteLength}},Encoder.prototype.encodeObject=function(object,depth){var ext=this.extensionCodec.tryToEncode(object,this.context);if(null!=ext)this.encodeExtension(ext);else if(Array.isArray(object))this.encodeArray(object,depth);else if(ArrayBuffer.isView(object))this.encodeBinary(object);else{if("object"!=typeof object)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(object)));this.encodeMap(object,depth)}},Encoder.prototype.encodeBinary=function(object){var size=object.byteLength;if(size<256)this.writeU8(196),this.writeU8(size);else if(size<65536)this.writeU8(197),this.writeU16(size);else{if(!(size<4294967296))throw new Error("Too large binary: ".concat(size));this.writeU8(198),this.writeU32(size)}var bytes=ensureUint8Array(object);this.writeU8a(bytes)},Encoder.prototype.encodeArray=function(object,depth){var size=object.length;if(size<16)this.writeU8(144+size);else if(size<65536)this.writeU8(220),this.writeU16(size);else{if(!(size<4294967296))throw new Error("Too large array: ".concat(size));this.writeU8(221),this.writeU32(size)}for(var _i=0,object_1=object;_i<object_1.length;_i++){var item=object_1[_i];this.doEncode(item,depth+1)}},Encoder.prototype.countWithoutUndefined=function(object,keys){for(var count=0,_i=0,keys_1=keys;_i<keys_1.length;_i++){void 0!==object[keys_1[_i]]&&count++}return count},Encoder.prototype.encodeMap=function(object,depth){var keys=Object.keys(object);this.sortKeys&&keys.sort();var size=this.ignoreUndefined?this.countWithoutUndefined(object,keys):keys.length;if(size<16)this.writeU8(128+size);else if(size<65536)this.writeU8(222),this.writeU16(size);else{if(!(size<4294967296))throw new Error("Too large map object: ".concat(size));this.writeU8(223),this.writeU32(size)}for(var _i=0,keys_2=keys;_i<keys_2.length;_i++){var key=keys_2[_i],value=object[key];this.ignoreUndefined&&void 0===value||(this.encodeString(key),this.doEncode(value,depth+1))}},Encoder.prototype.encodeExtension=function(ext){var size=ext.data.length;if(1===size)this.writeU8(212);else if(2===size)this.writeU8(213);else if(4===size)this.writeU8(214);else if(8===size)this.writeU8(215);else if(16===size)this.writeU8(216);else if(size<256)this.writeU8(199),this.writeU8(size);else if(size<65536)this.writeU8(200),this.writeU16(size);else{if(!(size<4294967296))throw new Error("Too large extension object: ".concat(size));this.writeU8(201),this.writeU32(size)}this.writeI8(ext.type),this.writeU8a(ext.data)},Encoder.prototype.writeU8=function(value){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,value),this.pos++},Encoder.prototype.writeU8a=function(values){var size=values.length;this.ensureBufferSizeToWrite(size),this.bytes.set(values,this.pos),this.pos+=size},Encoder.prototype.writeI8=function(value){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,value),this.pos++},Encoder.prototype.writeU16=function(value){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,value),this.pos+=2},Encoder.prototype.writeI16=function(value){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,value),this.pos+=2},Encoder.prototype.writeU32=function(value){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,value),this.pos+=4},Encoder.prototype.writeI32=function(value){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,value),this.pos+=4},Encoder.prototype.writeF32=function(value){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,value),this.pos+=4},Encoder.prototype.writeF64=function(value){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,value),this.pos+=8},Encoder.prototype.writeU64=function(value){this.ensureBufferSizeToWrite(8),function setUint64(view,offset,value){var high=value/4294967296,low=value;view.setUint32(offset,high),view.setUint32(offset+4,low)}(this.view,this.pos,value),this.pos+=8},Encoder.prototype.writeI64=function(value){this.ensureBufferSizeToWrite(8),setInt64(this.view,this.pos,value),this.pos+=8}}();function prettyByte(byte){return"".concat(byte<0?"-":"","0x").concat(Math.abs(byte).toString(16).padStart(2,"0"))}var CachedKeyDecoder=function(){function CachedKeyDecoder(maxKeyLength,maxLengthPerKey){void 0===maxKeyLength&&(maxKeyLength=16),void 0===maxLengthPerKey&&(maxLengthPerKey=16),this.maxKeyLength=maxKeyLength,this.maxLengthPerKey=maxLengthPerKey,this.hit=0,this.miss=0,this.caches=[];for(var i=0;i<this.maxKeyLength;i++)this.caches.push([])}return CachedKeyDecoder.prototype.canBeCached=function(byteLength){return byteLength>0&&byteLength<=this.maxKeyLength},CachedKeyDecoder.prototype.find=function(bytes,inputOffset,byteLength){FIND_CHUNK:for(var _i=0,records_1=this.caches[byteLength-1];_i<records_1.length;_i++){for(var record=records_1[_i],recordBytes=record.bytes,j=0;j<byteLength;j++)if(recordBytes[j]!==bytes[inputOffset+j])continue FIND_CHUNK;return record.str}return null},CachedKeyDecoder.prototype.store=function(bytes,value){var records=this.caches[bytes.length-1],record={bytes,str:value};records.length>=this.maxLengthPerKey?records[Math.random()*records.length|0]=record:records.push(record)},CachedKeyDecoder.prototype.decode=function(bytes,inputOffset,byteLength){var cachedValue=this.find(bytes,inputOffset,byteLength);if(null!=cachedValue)return this.hit++,cachedValue;this.miss++;var str=utf8DecodeJs(bytes,inputOffset,byteLength),slicedCopyOfBytes=Uint8Array.prototype.slice.call(bytes,inputOffset,inputOffset+byteLength);return this.store(slicedCopyOfBytes,str),str},CachedKeyDecoder}(),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__generator=function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}},__asyncValues=function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)})(resolve,reject,(v=o[n](v)).done,v.value)}))}}},__await=function(v){return this instanceof __await?(this.v=v,this):new __await(v)},__asyncGenerator=function(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise((function(a,b){q.push([n,v,a,b])>1||resume(n,v)}))})}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}},EMPTY_VIEW=new DataView(new ArrayBuffer(0)),EMPTY_BYTES=new Uint8Array(EMPTY_VIEW.buffer),DataViewIndexOutOfBoundsError=function(){try{EMPTY_VIEW.getInt8(0)}catch(e){return e.constructor}throw new Error("never reached")}(),MORE_DATA=new DataViewIndexOutOfBoundsError("Insufficient data"),sharedCachedKeyDecoder=new CachedKeyDecoder;!function(){function Decoder(extensionCodec,context,maxStrLength,maxBinLength,maxArrayLength,maxMapLength,maxExtLength,keyDecoder){void 0===extensionCodec&&(extensionCodec=ExtensionCodec.defaultCodec),void 0===context&&(context=void 0),void 0===maxStrLength&&(maxStrLength=4294967295),void 0===maxBinLength&&(maxBinLength=4294967295),void 0===maxArrayLength&&(maxArrayLength=4294967295),void 0===maxMapLength&&(maxMapLength=4294967295),void 0===maxExtLength&&(maxExtLength=4294967295),void 0===keyDecoder&&(keyDecoder=sharedCachedKeyDecoder),this.extensionCodec=extensionCodec,this.context=context,this.maxStrLength=maxStrLength,this.maxBinLength=maxBinLength,this.maxArrayLength=maxArrayLength,this.maxMapLength=maxMapLength,this.maxExtLength=maxExtLength,this.keyDecoder=keyDecoder,this.totalPos=0,this.pos=0,this.view=EMPTY_VIEW,this.bytes=EMPTY_BYTES,this.headByte=-1,this.stack=[]}Decoder.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},Decoder.prototype.setBuffer=function(buffer){this.bytes=ensureUint8Array(buffer),this.view=function createDataView(buffer){if(buffer instanceof ArrayBuffer)return new DataView(buffer);var bufferView=ensureUint8Array(buffer);return new DataView(bufferView.buffer,bufferView.byteOffset,bufferView.byteLength)}(this.bytes),this.pos=0},Decoder.prototype.appendBuffer=function(buffer){if(-1!==this.headByte||this.hasRemaining(1)){var remainingData=this.bytes.subarray(this.pos),newData=ensureUint8Array(buffer),newBuffer=new Uint8Array(remainingData.length+newData.length);newBuffer.set(remainingData),newBuffer.set(newData,remainingData.length),this.setBuffer(newBuffer)}else this.setBuffer(buffer)},Decoder.prototype.hasRemaining=function(size){return this.view.byteLength-this.pos>=size},Decoder.prototype.createExtraByteError=function(posToShow){var view=this.view,pos=this.pos;return new RangeError("Extra ".concat(view.byteLength-pos," of ").concat(view.byteLength," byte(s) found at buffer[").concat(posToShow,"]"))},Decoder.prototype.decode=function(buffer){this.reinitializeState(),this.setBuffer(buffer);var object=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return object},Decoder.prototype.decodeMulti=function(buffer){return __generator(this,(function(_a){switch(_a.label){case 0:this.reinitializeState(),this.setBuffer(buffer),_a.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return _a.sent(),[3,1];case 3:return[2]}}))},Decoder.prototype.decodeAsync=function(stream){var stream_1,stream_1_1,e_1,_a;return __awaiter(this,void 0,void 0,(function(){var decoded,object,buffer,e_1_1,_b,headByte,pos,totalPos;return __generator(this,(function(_c){switch(_c.label){case 0:decoded=!1,_c.label=1;case 1:_c.trys.push([1,6,7,12]),stream_1=__asyncValues(stream),_c.label=2;case 2:return[4,stream_1.next()];case 3:if((stream_1_1=_c.sent()).done)return[3,5];if(buffer=stream_1_1.value,decoded)throw this.createExtraByteError(this.totalPos);this.appendBuffer(buffer);try{object=this.doDecodeSync(),decoded=!0}catch(e){if(!(e instanceof DataViewIndexOutOfBoundsError))throw e}this.totalPos+=this.pos,_c.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return e_1_1=_c.sent(),e_1={error:e_1_1},[3,12];case 7:return _c.trys.push([7,,10,11]),stream_1_1&&!stream_1_1.done&&(_a=stream_1.return)?[4,_a.call(stream_1)]:[3,9];case 8:_c.sent(),_c.label=9;case 9:return[3,11];case 10:if(e_1)throw e_1.error;return[7];case 11:return[7];case 12:if(decoded){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,object]}throw headByte=(_b=this).headByte,pos=_b.pos,totalPos=_b.totalPos,new RangeError("Insufficient data in parsing ".concat(prettyByte(headByte)," at ").concat(totalPos," (").concat(pos," in the current buffer)"))}}))}))},Decoder.prototype.decodeArrayStream=function(stream){return this.decodeMultiAsync(stream,!0)},Decoder.prototype.decodeStream=function(stream){return this.decodeMultiAsync(stream,!1)},Decoder.prototype.decodeMultiAsync=function(stream,isArray){return __asyncGenerator(this,arguments,(function decodeMultiAsync_1(){var isArrayHeaderRequired,arrayItemsLeft,stream_2,stream_2_1,buffer,e_2,e_3_1,e_3,_a;return __generator(this,(function(_b){switch(_b.label){case 0:isArrayHeaderRequired=isArray,arrayItemsLeft=-1,_b.label=1;case 1:_b.trys.push([1,13,14,19]),stream_2=__asyncValues(stream),_b.label=2;case 2:return[4,__await(stream_2.next())];case 3:if((stream_2_1=_b.sent()).done)return[3,12];if(buffer=stream_2_1.value,isArray&&0===arrayItemsLeft)throw this.createExtraByteError(this.totalPos);this.appendBuffer(buffer),isArrayHeaderRequired&&(arrayItemsLeft=this.readArraySize(),isArrayHeaderRequired=!1,this.complete()),_b.label=4;case 4:_b.trys.push([4,9,,10]),_b.label=5;case 5:return[4,__await(this.doDecodeSync())];case 6:return[4,_b.sent()];case 7:return _b.sent(),0==--arrayItemsLeft?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((e_2=_b.sent())instanceof DataViewIndexOutOfBoundsError))throw e_2;return[3,10];case 10:this.totalPos+=this.pos,_b.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return e_3_1=_b.sent(),e_3={error:e_3_1},[3,19];case 14:return _b.trys.push([14,,17,18]),stream_2_1&&!stream_2_1.done&&(_a=stream_2.return)?[4,__await(_a.call(stream_2))]:[3,16];case 15:_b.sent(),_b.label=16;case 16:return[3,18];case 17:if(e_3)throw e_3.error;return[7];case 18:return[7];case 19:return[2]}}))}))},Decoder.prototype.doDecodeSync=function(){DECODE:for(;;){var headByte=this.readHeadByte(),object=void 0;if(headByte>=224)object=headByte-256;else if(headByte<192)if(headByte<128)object=headByte;else if(headByte<144){if(0!==(size=headByte-128)){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(headByte<160){if(0!==(size=headByte-144)){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else{var byteLength=headByte-160;object=this.decodeUtf8String(byteLength,0)}else if(192===headByte)object=null;else if(194===headByte)object=!1;else if(195===headByte)object=!0;else if(202===headByte)object=this.readF32();else if(203===headByte)object=this.readF64();else if(204===headByte)object=this.readU8();else if(205===headByte)object=this.readU16();else if(206===headByte)object=this.readU32();else if(207===headByte)object=this.readU64();else if(208===headByte)object=this.readI8();else if(209===headByte)object=this.readI16();else if(210===headByte)object=this.readI32();else if(211===headByte)object=this.readI64();else if(217===headByte){byteLength=this.lookU8();object=this.decodeUtf8String(byteLength,1)}else if(218===headByte){byteLength=this.lookU16();object=this.decodeUtf8String(byteLength,2)}else if(219===headByte){byteLength=this.lookU32();object=this.decodeUtf8String(byteLength,4)}else if(220===headByte){if(0!==(size=this.readU16())){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else if(221===headByte){if(0!==(size=this.readU32())){this.pushArrayState(size),this.complete();continue DECODE}object=[]}else if(222===headByte){if(0!==(size=this.readU16())){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(223===headByte){if(0!==(size=this.readU32())){this.pushMapState(size),this.complete();continue DECODE}object={}}else if(196===headByte){var size=this.lookU8();object=this.decodeBinary(size,1)}else if(197===headByte){size=this.lookU16();object=this.decodeBinary(size,2)}else if(198===headByte){size=this.lookU32();object=this.decodeBinary(size,4)}else if(212===headByte)object=this.decodeExtension(1,0);else if(213===headByte)object=this.decodeExtension(2,0);else if(214===headByte)object=this.decodeExtension(4,0);else if(215===headByte)object=this.decodeExtension(8,0);else if(216===headByte)object=this.decodeExtension(16,0);else if(199===headByte){size=this.lookU8();object=this.decodeExtension(size,1)}else if(200===headByte){size=this.lookU16();object=this.decodeExtension(size,2)}else{if(201!==headByte)throw new DecodeError("Unrecognized type byte: ".concat(prettyByte(headByte)));size=this.lookU32();object=this.decodeExtension(size,4)}this.complete();for(var stack=this.stack;stack.length>0;){var state=stack[stack.length-1];if(0===state.type){if(state.array[state.position]=object,state.position++,state.position!==state.size)continue DECODE;stack.pop(),object=state.array}else{if(1===state.type){if(keyType=void 0,"string"!==(keyType=typeof object)&&"number"!==keyType)throw new DecodeError("The type of key must be string or number but "+typeof object);if("__proto__"===object)throw new DecodeError("The key __proto__ is not allowed");state.key=object,state.type=2;continue DECODE}if(state.map[state.key]=object,state.readCount++,state.readCount!==state.size){state.key=null,state.type=1;continue DECODE}stack.pop(),object=state.map}}return object}var keyType},Decoder.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},Decoder.prototype.complete=function(){this.headByte=-1},Decoder.prototype.readArraySize=function(){var headByte=this.readHeadByte();switch(headByte){case 220:return this.readU16();case 221:return this.readU32();default:if(headByte<160)return headByte-144;throw new DecodeError("Unrecognized array type byte: ".concat(prettyByte(headByte)))}},Decoder.prototype.pushMapState=function(size){if(size>this.maxMapLength)throw new DecodeError("Max length exceeded: map length (".concat(size,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size,key:null,readCount:0,map:{}})},Decoder.prototype.pushArrayState=function(size){if(size>this.maxArrayLength)throw new DecodeError("Max length exceeded: array length (".concat(size,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size,array:new Array(size),position:0})},Decoder.prototype.decodeUtf8String=function(byteLength,headerOffset){var _a;if(byteLength>this.maxStrLength)throw new DecodeError("Max length exceeded: UTF-8 byte length (".concat(byteLength,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+headerOffset+byteLength)throw MORE_DATA;var object,offset=this.pos+headerOffset;return object=this.stateIsMapKey()&&(null===(_a=this.keyDecoder)||void 0===_a?void 0:_a.canBeCached(byteLength))?this.keyDecoder.decode(this.bytes,offset,byteLength):byteLength>TEXT_DECODER_THRESHOLD?function utf8DecodeTD(bytes,inputOffset,byteLength){var stringBytes=bytes.subarray(inputOffset,inputOffset+byteLength);return sharedTextDecoder.decode(stringBytes)}(this.bytes,offset,byteLength):utf8DecodeJs(this.bytes,offset,byteLength),this.pos+=headerOffset+byteLength,object},Decoder.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},Decoder.prototype.decodeBinary=function(byteLength,headOffset){if(byteLength>this.maxBinLength)throw new DecodeError("Max length exceeded: bin length (".concat(byteLength,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(byteLength+headOffset))throw MORE_DATA;var offset=this.pos+headOffset,object=this.bytes.subarray(offset,offset+byteLength);return this.pos+=headOffset+byteLength,object},Decoder.prototype.decodeExtension=function(size,headOffset){if(size>this.maxExtLength)throw new DecodeError("Max length exceeded: ext length (".concat(size,") > maxExtLength (").concat(this.maxExtLength,")"));var extType=this.view.getInt8(this.pos+headOffset),data=this.decodeBinary(size,headOffset+1);return this.extensionCodec.decode(data,extType,this.context)},Decoder.prototype.lookU8=function(){return this.view.getUint8(this.pos)},Decoder.prototype.lookU16=function(){return this.view.getUint16(this.pos)},Decoder.prototype.lookU32=function(){return this.view.getUint32(this.pos)},Decoder.prototype.readU8=function(){var value=this.view.getUint8(this.pos);return this.pos++,value},Decoder.prototype.readI8=function(){var value=this.view.getInt8(this.pos);return this.pos++,value},Decoder.prototype.readU16=function(){var value=this.view.getUint16(this.pos);return this.pos+=2,value},Decoder.prototype.readI16=function(){var value=this.view.getInt16(this.pos);return this.pos+=2,value},Decoder.prototype.readU32=function(){var value=this.view.getUint32(this.pos);return this.pos+=4,value},Decoder.prototype.readI32=function(){var value=this.view.getInt32(this.pos);return this.pos+=4,value},Decoder.prototype.readU64=function(){var value=function getUint64(view,offset){return 4294967296*view.getUint32(offset)+view.getUint32(offset+4)}(this.view,this.pos);return this.pos+=8,value},Decoder.prototype.readI64=function(){var value=getInt64(this.view,this.pos);return this.pos+=8,value},Decoder.prototype.readF32=function(){var value=this.view.getFloat32(this.pos);return this.pos+=4,value},Decoder.prototype.readF64=function(){var value=this.view.getFloat64(this.pos);return this.pos+=8,value}}();function $parcel$export(e,n,v,s){Object.defineProperty(e,n,{get:v,set:s,enumerable:!0,configurable:!0})}class $fcbcc7538a6776d5$export$f1c5f4c9cb95390b{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=blob=>{const chunks=[],size=blob.byteLength,total=Math.ceil(size/this.chunkedMTU);let index=0,start=0;for(;start<size;){const end=Math.min(size,start+this.chunkedMTU),b=blob.slice(start,end),chunk={__peerData:this._dataCount,n:index,data:b,total};chunks.push(chunk),start=end,index++}return this._dataCount++,chunks}}}function $fcbcc7538a6776d5$export$52c89ebcdc4f53f2(bufs){let size=0;for(const buf of bufs)size+=buf.byteLength;const result=new Uint8Array(size);let offset=0;for(const buf of bufs)result.set(buf,offset),offset+=buf.byteLength;return result}const $fb63e766cfafaab9$var$webRTCAdapter=adapter_core.default||adapter_core,$fb63e766cfafaab9$export$25be9502477c137d=new class{isWebRTCSupported(){return"undefined"!=typeof RTCPeerConnection}isBrowserSupported(){const browser=this.getBrowser(),version=this.getVersion();return!!this.supportedBrowsers.includes(browser)&&("chrome"===browser?version>=this.minChromeVersion:"firefox"===browser?version>=this.minFirefoxVersion:"safari"===browser&&(!this.isIOS&&version>=this.minSafariVersion))}getBrowser(){return $fb63e766cfafaab9$var$webRTCAdapter.browserDetails.browser}getVersion(){return $fb63e766cfafaab9$var$webRTCAdapter.browserDetails.version||0}isUnifiedPlanSupported(){const browser=this.getBrowser(),version=$fb63e766cfafaab9$var$webRTCAdapter.browserDetails.version||0;if("chrome"===browser&&version<this.minChromeVersion)return!1;if("firefox"===browser&&version>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let tempPc,supported=!1;try{tempPc=new RTCPeerConnection,tempPc.addTransceiver("audio"),supported=!0}catch(e){}finally{tempPc&&tempPc.close()}return supported}toString(){return`Supports:\n    browser:${this.getBrowser()}\n    version:${this.getVersion()}\n    isIOS:${this.isIOS}\n    isWebRTCSupported:${this.isWebRTCSupported()}\n    isBrowserSupported:${this.isBrowserSupported()}\n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS="undefined"!=typeof navigator&&["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},$9a84a32bf0bf36bb$export$f35f128fd59ea256=id=>!id||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id),$0e5fd1585784c252$export$4e61f672936bec77=()=>Math.random().toString(36).slice(2),$4f4134156c446392$var$DEFAULT_CONFIG={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};const $4f4134156c446392$export$7debb50ef11d5e0b=new class $4f4134156c446392$export$f8f26dd395d7e1bd extends $fcbcc7538a6776d5$export$f1c5f4c9cb95390b{noop(){}blobToArrayBuffer(blob,cb){const fr=new FileReader;return fr.onload=function(evt){evt.target&&cb(evt.target.result)},fr.readAsArrayBuffer(blob),fr}binaryStringToArrayBuffer(binary){const byteArray=new Uint8Array(binary.length);for(let i=0;i<binary.length;i++)byteArray[i]=255&binary.charCodeAt(i);return byteArray.buffer}isSecure(){return"https:"===location.protocol}constructor(...args){super(...args),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=$4f4134156c446392$var$DEFAULT_CONFIG,this.browser=$fb63e766cfafaab9$export$25be9502477c137d.getBrowser(),this.browserVersion=$fb63e766cfafaab9$export$25be9502477c137d.getVersion(),this.pack=$0cfd7828ad59115f$export$2a703dbb0cb35339,this.unpack=$0cfd7828ad59115f$export$417857010dc9287f,this.supports=function(){const supported={browser:$fb63e766cfafaab9$export$25be9502477c137d.isBrowserSupported(),webRTC:$fb63e766cfafaab9$export$25be9502477c137d.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!supported.webRTC)return supported;let pc;try{let dc;pc=new RTCPeerConnection($4f4134156c446392$var$DEFAULT_CONFIG),supported.audioVideo=!0;try{dc=pc.createDataChannel("_PEERJSTEST",{ordered:!0}),supported.data=!0,supported.reliable=!!dc.ordered;try{dc.binaryType="blob",supported.binaryBlob=!$fb63e766cfafaab9$export$25be9502477c137d.isIOS}catch(e){}}catch(e){}finally{dc&&dc.close()}}catch(e){}finally{pc&&pc.close()}return supported}(),this.validateId=$9a84a32bf0bf36bb$export$f35f128fd59ea256,this.randomToken=$0e5fd1585784c252$export$4e61f672936bec77}};var $257947e92926277a$export$243e62d78d3b544d,LogLevel;(LogLevel=$257947e92926277a$export$243e62d78d3b544d||($257947e92926277a$export$243e62d78d3b544d={}))[LogLevel.Disabled=0]="Disabled",LogLevel[LogLevel.Errors=1]="Errors",LogLevel[LogLevel.Warnings=2]="Warnings",LogLevel[LogLevel.All=3]="All";var $c4dcfd1d1ea86647$exports,$257947e92926277a$export$2e2bcd8739ae039=new class $257947e92926277a$var$Logger{get logLevel(){return this._logLevel}set logLevel(logLevel){this._logLevel=logLevel}log(...args){this._logLevel>=3&&this._print(3,...args)}warn(...args){this._logLevel>=2&&this._print(2,...args)}error(...args){this._logLevel>=1&&this._print(1,...args)}setLogFunction(fn){this._print=fn}_print(logLevel,...rest){const copy=["PeerJS: ",...rest];for(const i in copy)copy[i]instanceof Error&&(copy[i]="("+copy[i].name+") "+copy[i].message);logLevel>=3?console.log(...copy):logLevel>=2?console.warn("WARNING",...copy):logLevel>=1&&console.error("ERROR",...copy)}constructor(){this._logLevel=0}},$c4dcfd1d1ea86647$var$has=Object.prototype.hasOwnProperty,$c4dcfd1d1ea86647$var$prefix="~";function $c4dcfd1d1ea86647$var$Events(){}function $c4dcfd1d1ea86647$var$EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function $c4dcfd1d1ea86647$var$addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new $c4dcfd1d1ea86647$var$EE(fn,context||emitter,once),evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function $c4dcfd1d1ea86647$var$clearEvent(emitter,evt){0==--emitter._eventsCount?emitter._events=new $c4dcfd1d1ea86647$var$Events:delete emitter._events[evt]}function $c4dcfd1d1ea86647$var$EventEmitter(){this._events=new $c4dcfd1d1ea86647$var$Events,this._eventsCount=0}Object.create&&($c4dcfd1d1ea86647$var$Events.prototype=Object.create(null),(new $c4dcfd1d1ea86647$var$Events).__proto__||($c4dcfd1d1ea86647$var$prefix=!1)),$c4dcfd1d1ea86647$var$EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)$c4dcfd1d1ea86647$var$has.call(events,name)&&names.push($c4dcfd1d1ea86647$var$prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},$c4dcfd1d1ea86647$var$EventEmitter.prototype.listeners=function listeners(event){var evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},$c4dcfd1d1ea86647$var$EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},$c4dcfd1d1ea86647$var$EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},$c4dcfd1d1ea86647$var$EventEmitter.prototype.on=function on(event,fn,context){return $c4dcfd1d1ea86647$var$addListener(this,event,fn,context,!1)},$c4dcfd1d1ea86647$var$EventEmitter.prototype.once=function once(event,fn,context){return $c4dcfd1d1ea86647$var$addListener(this,event,fn,context,!0)},$c4dcfd1d1ea86647$var$EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event;if(!this._events[evt])return this;if(!fn)return $c4dcfd1d1ea86647$var$clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||$c4dcfd1d1ea86647$var$clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:$c4dcfd1d1ea86647$var$clearEvent(this,evt)}return this},$c4dcfd1d1ea86647$var$EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=$c4dcfd1d1ea86647$var$prefix?$c4dcfd1d1ea86647$var$prefix+event:event,this._events[evt]&&$c4dcfd1d1ea86647$var$clearEvent(this,evt)):(this._events=new $c4dcfd1d1ea86647$var$Events,this._eventsCount=0),this},$c4dcfd1d1ea86647$var$EventEmitter.prototype.off=$c4dcfd1d1ea86647$var$EventEmitter.prototype.removeListener,$c4dcfd1d1ea86647$var$EventEmitter.prototype.addListener=$c4dcfd1d1ea86647$var$EventEmitter.prototype.on,$c4dcfd1d1ea86647$var$EventEmitter.prefixed=$c4dcfd1d1ea86647$var$prefix,$c4dcfd1d1ea86647$var$EventEmitter.EventEmitter=$c4dcfd1d1ea86647$var$EventEmitter,$c4dcfd1d1ea86647$exports=$c4dcfd1d1ea86647$var$EventEmitter;var $78455e22dea96b8c$export$3157d57b4135e3bc,ConnectionType,$78455e22dea96b8c$export$9547aaa2e39030ff,PeerErrorType,$78455e22dea96b8c$export$7974935686149686,BaseConnectionErrorType,$78455e22dea96b8c$export$49ae800c114df41d,DataConnectionErrorType,$78455e22dea96b8c$export$89f507cf986a947,SerializationType,$78455e22dea96b8c$export$3b5c4a4b6354f023,SocketEventType,$78455e22dea96b8c$export$adb4a1754da6f10d,ServerMessageType,$78455e22dea96b8c$exports={};$parcel$export($78455e22dea96b8c$exports,"ConnectionType",(()=>$78455e22dea96b8c$export$3157d57b4135e3bc)),$parcel$export($78455e22dea96b8c$exports,"PeerErrorType",(()=>$78455e22dea96b8c$export$9547aaa2e39030ff)),$parcel$export($78455e22dea96b8c$exports,"BaseConnectionErrorType",(()=>$78455e22dea96b8c$export$7974935686149686)),$parcel$export($78455e22dea96b8c$exports,"DataConnectionErrorType",(()=>$78455e22dea96b8c$export$49ae800c114df41d)),$parcel$export($78455e22dea96b8c$exports,"SerializationType",(()=>$78455e22dea96b8c$export$89f507cf986a947)),$parcel$export($78455e22dea96b8c$exports,"SocketEventType",(()=>$78455e22dea96b8c$export$3b5c4a4b6354f023)),$parcel$export($78455e22dea96b8c$exports,"ServerMessageType",(()=>$78455e22dea96b8c$export$adb4a1754da6f10d)),(ConnectionType=$78455e22dea96b8c$export$3157d57b4135e3bc||($78455e22dea96b8c$export$3157d57b4135e3bc={})).Data="data",ConnectionType.Media="media",(PeerErrorType=$78455e22dea96b8c$export$9547aaa2e39030ff||($78455e22dea96b8c$export$9547aaa2e39030ff={})).BrowserIncompatible="browser-incompatible",PeerErrorType.Disconnected="disconnected",PeerErrorType.InvalidID="invalid-id",PeerErrorType.InvalidKey="invalid-key",PeerErrorType.Network="network",PeerErrorType.PeerUnavailable="peer-unavailable",PeerErrorType.SslUnavailable="ssl-unavailable",PeerErrorType.ServerError="server-error",PeerErrorType.SocketError="socket-error",PeerErrorType.SocketClosed="socket-closed",PeerErrorType.UnavailableID="unavailable-id",PeerErrorType.WebRTC="webrtc",(BaseConnectionErrorType=$78455e22dea96b8c$export$7974935686149686||($78455e22dea96b8c$export$7974935686149686={})).NegotiationFailed="negotiation-failed",BaseConnectionErrorType.ConnectionClosed="connection-closed",(DataConnectionErrorType=$78455e22dea96b8c$export$49ae800c114df41d||($78455e22dea96b8c$export$49ae800c114df41d={})).NotOpenYet="not-open-yet",DataConnectionErrorType.MessageToBig="message-too-big",(SerializationType=$78455e22dea96b8c$export$89f507cf986a947||($78455e22dea96b8c$export$89f507cf986a947={})).Binary="binary",SerializationType.BinaryUTF8="binary-utf8",SerializationType.JSON="json",SerializationType.None="raw",(SocketEventType=$78455e22dea96b8c$export$3b5c4a4b6354f023||($78455e22dea96b8c$export$3b5c4a4b6354f023={})).Message="message",SocketEventType.Disconnected="disconnected",SocketEventType.Error="error",SocketEventType.Close="close",(ServerMessageType=$78455e22dea96b8c$export$adb4a1754da6f10d||($78455e22dea96b8c$export$adb4a1754da6f10d={})).Heartbeat="HEARTBEAT",ServerMessageType.Candidate="CANDIDATE",ServerMessageType.Offer="OFFER",ServerMessageType.Answer="ANSWER",ServerMessageType.Open="OPEN",ServerMessageType.Error="ERROR",ServerMessageType.IdTaken="ID-TAKEN",ServerMessageType.InvalidKey="INVALID-KEY",ServerMessageType.Leave="LEAVE",ServerMessageType.Expire="EXPIRE";var $f5f881ec4575f1fc$exports;$f5f881ec4575f1fc$exports=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class $8f5bfa60836d261d$export$4798917dbf149b79 extends $c4dcfd1d1ea86647$exports.EventEmitter{constructor(secure,host,port,path,key,pingInterval=5e3){super(),this.pingInterval=pingInterval,this._disconnected=!0,this._messagesQueue=[];const wsProtocol=secure?"wss://":"ws://";this._baseUrl=wsProtocol+host+":"+port+path+"peerjs?key="+key}start(id,token){this._id=id;const wsUrl=`${this._baseUrl}&id=${id}&token=${token}`;!this._socket&&this._disconnected&&(this._socket=new WebSocket(wsUrl+"&version="+$f5f881ec4575f1fc$exports.version),this._disconnected=!1,this._socket.onmessage=event=>{let data;try{data=JSON.parse(event.data),$257947e92926277a$export$2e2bcd8739ae039.log("Server message received:",data)}catch(e){return void $257947e92926277a$export$2e2bcd8739ae039.log("Invalid server message",event.data)}this.emit($78455e22dea96b8c$export$3b5c4a4b6354f023.Message,data)},this._socket.onclose=event=>{this._disconnected||($257947e92926277a$export$2e2bcd8739ae039.log("Socket closed.",event),this._cleanup(),this._disconnected=!0,this.emit($78455e22dea96b8c$export$3b5c4a4b6354f023.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),$257947e92926277a$export$2e2bcd8739ae039.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout((()=>{this._sendHeartbeat()}),this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen())return void $257947e92926277a$export$2e2bcd8739ae039.log("Cannot send heartbeat, because socket closed");const message=JSON.stringify({type:$78455e22dea96b8c$export$adb4a1754da6f10d.Heartbeat});this._socket.send(message),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&1===this._socket.readyState}_sendQueuedMessages(){const copiedQueue=[...this._messagesQueue];this._messagesQueue=[];for(const message of copiedQueue)this.send(message)}send(data){if(this._disconnected)return;if(!this._id)return void this._messagesQueue.push(data);if(!data.type)return void this.emit($78455e22dea96b8c$export$3b5c4a4b6354f023.Error,"Invalid message");if(!this._wsOpen())return;const message=JSON.stringify(data);this._socket.send(message)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class $b82fb8fc0514bfc1$export$89e6bb5ad64bf4a{constructor(connection){this.connection=connection}startConnection(options){const peerConnection=this._startPeerConnection();if(this.connection.peerConnection=peerConnection,this.connection.type===$78455e22dea96b8c$export$3157d57b4135e3bc.Media&&options._stream&&this._addTracksToConnection(options._stream,peerConnection),options.originator){const dataConnection=this.connection,config={ordered:!!options.reliable},dataChannel=peerConnection.createDataChannel(dataConnection.label,config);dataConnection._initializeDataChannel(dataChannel),this._makeOffer()}else this.handleSDP("OFFER",options.sdp)}_startPeerConnection(){$257947e92926277a$export$2e2bcd8739ae039.log("Creating RTCPeerConnection.");const peerConnection=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(peerConnection),peerConnection}_setupListeners(peerConnection){const peerId=this.connection.peer,connectionId=this.connection.connectionId,connectionType=this.connection.type,provider=this.connection.provider;$257947e92926277a$export$2e2bcd8739ae039.log("Listening for ICE candidates."),peerConnection.onicecandidate=evt=>{evt.candidate&&evt.candidate.candidate&&($257947e92926277a$export$2e2bcd8739ae039.log(`Received ICE candidates for ${peerId}:`,evt.candidate),provider.socket.send({type:$78455e22dea96b8c$export$adb4a1754da6f10d.Candidate,payload:{candidate:evt.candidate,type:connectionType,connectionId},dst:peerId}))},peerConnection.oniceconnectionstatechange=()=>{switch(peerConnection.iceConnectionState){case"failed":$257947e92926277a$export$2e2bcd8739ae039.log("iceConnectionState is failed, closing connections to "+peerId),this.connection.emitError($78455e22dea96b8c$export$7974935686149686.NegotiationFailed,"Negotiation of connection to "+peerId+" failed."),this.connection.close();break;case"closed":$257947e92926277a$export$2e2bcd8739ae039.log("iceConnectionState is closed, closing connections to "+peerId),this.connection.emitError($78455e22dea96b8c$export$7974935686149686.ConnectionClosed,"Connection to "+peerId+" closed."),this.connection.close();break;case"disconnected":$257947e92926277a$export$2e2bcd8739ae039.log("iceConnectionState changed to disconnected on the connection with "+peerId);break;case"completed":peerConnection.onicecandidate=()=>{}}this.connection.emit("iceStateChanged",peerConnection.iceConnectionState)},$257947e92926277a$export$2e2bcd8739ae039.log("Listening for data channel"),peerConnection.ondatachannel=evt=>{$257947e92926277a$export$2e2bcd8739ae039.log("Received data channel");const dataChannel=evt.channel;provider.getConnection(peerId,connectionId)._initializeDataChannel(dataChannel)},$257947e92926277a$export$2e2bcd8739ae039.log("Listening for remote stream"),peerConnection.ontrack=evt=>{$257947e92926277a$export$2e2bcd8739ae039.log("Received remote stream");const stream=evt.streams[0],connection=provider.getConnection(peerId,connectionId);if(connection.type===$78455e22dea96b8c$export$3157d57b4135e3bc.Media){const mediaConnection=connection;this._addStreamToMediaConnection(stream,mediaConnection)}}}cleanup(){$257947e92926277a$export$2e2bcd8739ae039.log("Cleaning up PeerConnection to "+this.connection.peer);const peerConnection=this.connection.peerConnection;if(!peerConnection)return;this.connection.peerConnection=null,peerConnection.onicecandidate=peerConnection.oniceconnectionstatechange=peerConnection.ondatachannel=peerConnection.ontrack=()=>{};const peerConnectionNotClosed="closed"!==peerConnection.signalingState;let dataChannelNotClosed=!1;const dataChannel=this.connection.dataChannel;dataChannel&&(dataChannelNotClosed=!!dataChannel.readyState&&"closed"!==dataChannel.readyState),(peerConnectionNotClosed||dataChannelNotClosed)&&peerConnection.close()}async _makeOffer(){const peerConnection=this.connection.peerConnection,provider=this.connection.provider;try{const offer=await peerConnection.createOffer(this.connection.options.constraints);$257947e92926277a$export$2e2bcd8739ae039.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(offer.sdp=this.connection.options.sdpTransform(offer.sdp)||offer.sdp);try{await peerConnection.setLocalDescription(offer),$257947e92926277a$export$2e2bcd8739ae039.log("Set localDescription:",offer,`for:${this.connection.peer}`);let payload={sdp:offer,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===$78455e22dea96b8c$export$3157d57b4135e3bc.Data){const dataConnection=this.connection;payload={...payload,label:dataConnection.label,reliable:dataConnection.reliable,serialization:dataConnection.serialization}}provider.socket.send({type:$78455e22dea96b8c$export$adb4a1754da6f10d.Offer,payload,dst:this.connection.peer})}catch(err){"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=err&&(provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to setLocalDescription, ",err))}}catch(err_1){provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err_1),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to createOffer, ",err_1)}}async _makeAnswer(){const peerConnection=this.connection.peerConnection,provider=this.connection.provider;try{const answer=await peerConnection.createAnswer();$257947e92926277a$export$2e2bcd8739ae039.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(answer.sdp=this.connection.options.sdpTransform(answer.sdp)||answer.sdp);try{await peerConnection.setLocalDescription(answer),$257947e92926277a$export$2e2bcd8739ae039.log("Set localDescription:",answer,`for:${this.connection.peer}`),provider.socket.send({type:$78455e22dea96b8c$export$adb4a1754da6f10d.Answer,payload:{sdp:answer,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(err){provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to setLocalDescription, ",err)}}catch(err_1){provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err_1),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to create answer, ",err_1)}}async handleSDP(type,sdp){sdp=new RTCSessionDescription(sdp);const peerConnection=this.connection.peerConnection,provider=this.connection.provider;$257947e92926277a$export$2e2bcd8739ae039.log("Setting remote description",sdp);const self=this;try{await peerConnection.setRemoteDescription(sdp),$257947e92926277a$export$2e2bcd8739ae039.log(`Set remoteDescription:${type} for:${this.connection.peer}`),"OFFER"===type&&await self._makeAnswer()}catch(err){provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to setRemoteDescription, ",err)}}async handleCandidate(ice){$257947e92926277a$export$2e2bcd8739ae039.log("handleCandidate:",ice);try{await this.connection.peerConnection.addIceCandidate(ice),$257947e92926277a$export$2e2bcd8739ae039.log(`Added ICE candidate for:${this.connection.peer}`)}catch(err){this.connection.provider.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.WebRTC,err),$257947e92926277a$export$2e2bcd8739ae039.log("Failed to handleCandidate, ",err)}}_addTracksToConnection(stream,peerConnection){if($257947e92926277a$export$2e2bcd8739ae039.log(`add tracks from stream ${stream.id} to peer connection`),!peerConnection.addTrack)return $257947e92926277a$export$2e2bcd8739ae039.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");stream.getTracks().forEach((track=>{peerConnection.addTrack(track,stream)}))}_addStreamToMediaConnection(stream,mediaConnection){$257947e92926277a$export$2e2bcd8739ae039.log(`add stream ${stream.id} to media connection ${mediaConnection.connectionId}`),mediaConnection.addStream(stream)}}class $23779d1881157a18$export$6a678e589c8a4542 extends $c4dcfd1d1ea86647$exports.EventEmitter{emitError(type,err){$257947e92926277a$export$2e2bcd8739ae039.error("Error:",err),this.emit("error",new $23779d1881157a18$export$98871882f492de82(`${type}`,err))}}class $23779d1881157a18$export$98871882f492de82 extends Error{constructor(type,err){"string"==typeof err?super(err):(super(),Object.assign(this,err)),this.type=type}}class $5045192fc6d387ba$export$23a2a68283c24d80 extends $23779d1881157a18$export$6a678e589c8a4542{get open(){return this._open}constructor(peer,provider,options){super(),this.peer=peer,this.provider=provider,this.options=options,this._open=!1,this.metadata=options.metadata}}class $5c1d08c7c57da9a3$export$4a84e95a2324ac29 extends $5045192fc6d387ba$export$23a2a68283c24d80{static#_=this.ID_PREFIX="mc_";get type(){return $78455e22dea96b8c$export$3157d57b4135e3bc.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(peerId,provider,options){super(peerId,provider,options),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||$5c1d08c7c57da9a3$export$4a84e95a2324ac29.ID_PREFIX+$4f4134156c446392$export$7debb50ef11d5e0b.randomToken(),this._negotiator=new $b82fb8fc0514bfc1$export$89e6bb5ad64bf4a(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(dc){this.dataChannel=dc,this.dataChannel.onopen=()=>{$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(remoteStream){$257947e92926277a$export$2e2bcd8739ae039.log("Receiving stream",remoteStream),this._remoteStream=remoteStream,super.emit("stream",remoteStream)}handleMessage(message){const type=message.type,payload=message.payload;switch(message.type){case $78455e22dea96b8c$export$adb4a1754da6f10d.Answer:this._negotiator.handleSDP(type,payload.sdp),this._open=!0;break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Candidate:this._negotiator.handleCandidate(payload.candidate);break;default:$257947e92926277a$export$2e2bcd8739ae039.warn(`Unrecognized message type:${type} from peer:${this.peer}`)}}answer(stream,options={}){if(this._localStream)return void $257947e92926277a$export$2e2bcd8739ae039.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");this._localStream=stream,options&&options.sdpTransform&&(this.options.sdpTransform=options.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:stream});const messages=this.provider._getMessages(this.connectionId);for(const message of messages)this.handleMessage(message);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}}class $abf266641927cd89$export$2c4e825dc9120f87{constructor(_options){this._options=_options}_buildRequest(method){const protocol=this._options.secure?"https":"http",{host,port,path,key}=this._options,url=new URL(`${protocol}://${host}:${port}${path}${key}/${method}`);return url.searchParams.set("ts",`${Date.now()}${Math.random()}`),url.searchParams.set("version",$f5f881ec4575f1fc$exports.version),fetch(url.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const response=await this._buildRequest("id");if(200!==response.status)throw new Error(`Error. Status:${response.status}`);return response.text()}catch(error){$257947e92926277a$export$2e2bcd8739ae039.error("Error retrieving ID",error);let pathError="";throw"/"===this._options.path&&this._options.host!==$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_HOST&&(pathError=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+pathError)}}async listAllPeers(){try{const response=await this._buildRequest("peers");if(200!==response.status){if(401===response.status){let helpfulError="";throw helpfulError=this._options.host===$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+helpfulError)}throw new Error(`Error. Status:${response.status}`)}return response.json()}catch(error){throw $257947e92926277a$export$2e2bcd8739ae039.error("Error retrieving list peers",error),new Error("Could not get list peers from the server."+error)}}}class $6366c4ca161bc297$export$d365f7ad9d7df9c9 extends $5045192fc6d387ba$export$23a2a68283c24d80{static#_=this.ID_PREFIX="dc_";static#_2=this.MAX_BUFFERED_AMOUNT=8388608;get type(){return $78455e22dea96b8c$export$3157d57b4135e3bc.Data}constructor(peerId,provider,options){super(peerId,provider,options),this.connectionId=this.options.connectionId||$6366c4ca161bc297$export$d365f7ad9d7df9c9.ID_PREFIX+$0e5fd1585784c252$export$4e61f672936bec77(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new $b82fb8fc0514bfc1$export$89e6bb5ad64bf4a(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(dc){this.dataChannel=dc,this.dataChannel.onopen=()=>{$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=e=>{$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} dc onmessage:`,e.data)},this.dataChannel.onclose=()=>{$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(options){options?.flush?this.send({__peerData:{type:"close"}}):(this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close")))}send(data,chunked=!1){if(this.open)return this._send(data,chunked);this.emitError($78455e22dea96b8c$export$49ae800c114df41d.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.")}async handleMessage(message){const payload=message.payload;switch(message.type){case $78455e22dea96b8c$export$adb4a1754da6f10d.Answer:await this._negotiator.handleSDP(message.type,payload.sdp);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Candidate:await this._negotiator.handleCandidate(payload.candidate);break;default:$257947e92926277a$export$2e2bcd8739ae039.warn("Unrecognized message type:",message.type,"from peer:",this.peer)}}}class $a229bedbcaa6ca23$export$ff7c9d4c11d94e8b extends $6366c4ca161bc297$export$d365f7ad9d7df9c9{get bufferSize(){return this._bufferSize}_initializeDataChannel(dc){super._initializeDataChannel(dc),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",(e=>this._handleDataMessage(e)))}_bufferedSend(msg){!this._buffering&&this._trySend(msg)||(this._buffer.push(msg),this._bufferSize=this._buffer.length)}_trySend(msg){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>$6366c4ca161bc297$export$d365f7ad9d7df9c9.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((()=>{this._buffering=!1,this._tryBuffer()}),50),!1;try{this.dataChannel.send(msg)}catch(e){return $257947e92926277a$export$2e2bcd8739ae039.error(`DC#:${this.connectionId} Error when sending:`,e),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open)return;if(0===this._buffer.length)return;const msg=this._buffer[0];this._trySend(msg)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(options){options?.flush?this.send({__peerData:{type:"close"}}):(this._buffer=[],this._bufferSize=0,super.close())}constructor(...args){super(...args),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class $9fcfddb3ae148f88$export$f0a5a64d5bb37108 extends $a229bedbcaa6ca23$export$ff7c9d4c11d94e8b{close(options){super.close(options),this._chunkedData={}}constructor(peerId,provider,options){super(peerId,provider,options),this.chunker=new $fcbcc7538a6776d5$export$f1c5f4c9cb95390b,this.serialization=$78455e22dea96b8c$export$89f507cf986a947.Binary,this._chunkedData={}}_handleDataMessage({data}){const deserializedData=$0cfd7828ad59115f$export$417857010dc9287f(data),peerData=deserializedData.__peerData;if(peerData)return"close"===peerData.type?void this.close():void this._handleChunk(deserializedData);this.emit("data",deserializedData)}_handleChunk(data){const id=data.__peerData,chunkInfo=this._chunkedData[id]||{data:[],count:0,total:data.total};if(chunkInfo.data[data.n]=new Uint8Array(data.data),chunkInfo.count++,this._chunkedData[id]=chunkInfo,chunkInfo.total===chunkInfo.count){delete this._chunkedData[id];const data=$fcbcc7538a6776d5$export$52c89ebcdc4f53f2(chunkInfo.data);this._handleDataMessage({data})}}_send(data,chunked){const blob=$0cfd7828ad59115f$export$2a703dbb0cb35339(data);if(blob instanceof Promise)return this._send_blob(blob);!chunked&&blob.byteLength>this.chunker.chunkedMTU?this._sendChunks(blob):this._bufferedSend(blob)}async _send_blob(blobPromise){const blob=await blobPromise;blob.byteLength>this.chunker.chunkedMTU?this._sendChunks(blob):this._bufferedSend(blob)}_sendChunks(blob){const blobs=this.chunker.chunk(blob);$257947e92926277a$export$2e2bcd8739ae039.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);for(const blob of blobs)this.send(blob,!0)}}class $bbaee3f15f714663$export$6f88fe47d32c9c94 extends $a229bedbcaa6ca23$export$ff7c9d4c11d94e8b{_handleDataMessage({data}){super.emit("data",data)}_send(data,_chunked){this._bufferedSend(data)}constructor(...args){super(...args),this.serialization=$78455e22dea96b8c$export$89f507cf986a947.None}}class $817f931e3f9096cf$export$48880ac635f47186 extends $a229bedbcaa6ca23$export$ff7c9d4c11d94e8b{_handleDataMessage({data}){const deserializedData=this.parse(this.decoder.decode(data)),peerData=deserializedData.__peerData;peerData&&"close"===peerData.type?this.close():this.emit("data",deserializedData)}_send(data,_chunked){const encodedData=this.encoder.encode(this.stringify(data));encodedData.byteLength>=$4f4134156c446392$export$7debb50ef11d5e0b.chunkedMTU?this.emitError($78455e22dea96b8c$export$49ae800c114df41d.MessageToBig,"Message too big for JSON channel"):this._bufferedSend(encodedData)}constructor(...args){super(...args),this.serialization=$78455e22dea96b8c$export$89f507cf986a947.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}class $416260bce337df90$export$ecd1fc136c422448 extends $23779d1881157a18$export$6a678e589c8a4542{static#_=this.DEFAULT_KEY="peerjs";get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const plainConnections=Object.create(null);for(const[k,v]of this._connections)plainConnections[k]=v;return plainConnections}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(id,options){let userId;super(),this._serializers={raw:$bbaee3f15f714663$export$6f88fe47d32c9c94,json:$817f931e3f9096cf$export$48880ac635f47186,binary:$9fcfddb3ae148f88$export$f0a5a64d5bb37108,"binary-utf8":$9fcfddb3ae148f88$export$f0a5a64d5bb37108,default:$9fcfddb3ae148f88$export$f0a5a64d5bb37108},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map,id&&id.constructor==Object?options=id:id&&(userId=id.toString()),options={debug:0,host:$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_HOST,port:$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_PORT,path:"/",key:$416260bce337df90$export$ecd1fc136c422448.DEFAULT_KEY,token:$4f4134156c446392$export$7debb50ef11d5e0b.randomToken(),config:$4f4134156c446392$export$7debb50ef11d5e0b.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...options},this._options=options,this._serializers={...this._serializers,...this.options.serializers},"/"===this._options.host&&(this._options.host=window.location.hostname),this._options.path&&("/"!==this._options.path[0]&&(this._options.path="/"+this._options.path),"/"!==this._options.path[this._options.path.length-1]&&(this._options.path+="/")),void 0===this._options.secure&&this._options.host!==$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_HOST?this._options.secure=$4f4134156c446392$export$7debb50ef11d5e0b.isSecure():this._options.host==$4f4134156c446392$export$7debb50ef11d5e0b.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&$257947e92926277a$export$2e2bcd8739ae039.setLogFunction(this._options.logFunction),$257947e92926277a$export$2e2bcd8739ae039.logLevel=this._options.debug||0,this._api=new $abf266641927cd89$export$2c4e825dc9120f87(options),this._socket=this._createServerConnection(),$4f4134156c446392$export$7debb50ef11d5e0b.supports.audioVideo||$4f4134156c446392$export$7debb50ef11d5e0b.supports.data?!userId||$4f4134156c446392$export$7debb50ef11d5e0b.validateId(userId)?userId?this._initialize(userId):this._api.retrieveId().then((id=>this._initialize(id))).catch((error=>this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.ServerError,error))):this._delayedAbort($78455e22dea96b8c$export$9547aaa2e39030ff.InvalidID,`ID "${userId}" is invalid`):this._delayedAbort($78455e22dea96b8c$export$9547aaa2e39030ff.BrowserIncompatible,"The current browser does not support WebRTC")}_createServerConnection(){const socket=new $8f5bfa60836d261d$export$4798917dbf149b79(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return socket.on($78455e22dea96b8c$export$3b5c4a4b6354f023.Message,(data=>{this._handleMessage(data)})),socket.on($78455e22dea96b8c$export$3b5c4a4b6354f023.Error,(error=>{this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.SocketError,error)})),socket.on($78455e22dea96b8c$export$3b5c4a4b6354f023.Disconnected,(()=>{this.disconnected||(this.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.Network,"Lost connection to server."),this.disconnect())})),socket.on($78455e22dea96b8c$export$3b5c4a4b6354f023.Close,(()=>{this.disconnected||this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.SocketClosed,"Underlying socket is already closed.")})),socket}_initialize(id){this._id=id,this.socket.start(id,this._options.token)}_handleMessage(message){const type=message.type,payload=message.payload,peerId=message.src;switch(type){case $78455e22dea96b8c$export$adb4a1754da6f10d.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Error:this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.ServerError,payload.msg);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.IdTaken:this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.UnavailableID,`ID "${this.id}" is taken`);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.InvalidKey:this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Leave:$257947e92926277a$export$2e2bcd8739ae039.log(`Received leave message from ${peerId}`),this._cleanupPeer(peerId),this._connections.delete(peerId);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Expire:this.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.PeerUnavailable,`Could not connect to peer ${peerId}`);break;case $78455e22dea96b8c$export$adb4a1754da6f10d.Offer:{const connectionId=payload.connectionId;let connection=this.getConnection(peerId,connectionId);if(connection&&(connection.close(),$257947e92926277a$export$2e2bcd8739ae039.warn(`Offer received for existing Connection ID:${connectionId}`)),payload.type===$78455e22dea96b8c$export$3157d57b4135e3bc.Media){const mediaConnection=new $5c1d08c7c57da9a3$export$4a84e95a2324ac29(peerId,this,{connectionId,_payload:payload,metadata:payload.metadata});connection=mediaConnection,this._addConnection(peerId,connection),this.emit("call",mediaConnection)}else{if(payload.type!==$78455e22dea96b8c$export$3157d57b4135e3bc.Data)return void $257947e92926277a$export$2e2bcd8739ae039.warn(`Received malformed connection type:${payload.type}`);{const dataConnection=new this._serializers[payload.serialization](peerId,this,{connectionId,_payload:payload,metadata:payload.metadata,label:payload.label,serialization:payload.serialization,reliable:payload.reliable});connection=dataConnection,this._addConnection(peerId,connection),this.emit("connection",dataConnection)}}const messages=this._getMessages(connectionId);for(const message of messages)connection.handleMessage(message);break}default:{if(!payload)return void $257947e92926277a$export$2e2bcd8739ae039.warn(`You received a malformed message from ${peerId} of type ${type}`);const connectionId=payload.connectionId,connection=this.getConnection(peerId,connectionId);connection&&connection.peerConnection?connection.handleMessage(message):connectionId?this._storeMessage(connectionId,message):$257947e92926277a$export$2e2bcd8739ae039.warn("You received an unrecognized message:",message);break}}}_storeMessage(connectionId,message){this._lostMessages.has(connectionId)||this._lostMessages.set(connectionId,[]),this._lostMessages.get(connectionId).push(message)}_getMessages(connectionId){const messages=this._lostMessages.get(connectionId);return messages?(this._lostMessages.delete(connectionId),messages):[]}connect(peer,options={}){if(options={serialization:"default",...options},this.disconnected)return $257947e92926277a$export$2e2bcd8739ae039.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.Disconnected,"Cannot connect to new Peer after disconnecting from server.");const dataConnection=new this._serializers[options.serialization](peer,this,options);return this._addConnection(peer,dataConnection),dataConnection}call(peer,stream,options={}){if(this.disconnected)return $257947e92926277a$export$2e2bcd8739ae039.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError($78455e22dea96b8c$export$9547aaa2e39030ff.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(!stream)return void $257947e92926277a$export$2e2bcd8739ae039.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");const mediaConnection=new $5c1d08c7c57da9a3$export$4a84e95a2324ac29(peer,this,{...options,_stream:stream});return this._addConnection(peer,mediaConnection),mediaConnection}_addConnection(peerId,connection){$257947e92926277a$export$2e2bcd8739ae039.log(`add connection ${connection.type}:${connection.connectionId} to peerId:${peerId}`),this._connections.has(peerId)||this._connections.set(peerId,[]),this._connections.get(peerId).push(connection)}_removeConnection(connection){const connections=this._connections.get(connection.peer);if(connections){const index=connections.indexOf(connection);-1!==index&&connections.splice(index,1)}this._lostMessages.delete(connection.connectionId)}getConnection(peerId,connectionId){const connections=this._connections.get(peerId);if(!connections)return null;for(const connection of connections)if(connection.connectionId===connectionId)return connection;return null}_delayedAbort(type,message){setTimeout((()=>{this._abort(type,message)}),0)}_abort(type,message){$257947e92926277a$export$2e2bcd8739ae039.error("Aborting!"),this.emitError(type,message),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||($257947e92926277a$export$2e2bcd8739ae039.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const peerId of this._connections.keys())this._cleanupPeer(peerId),this._connections.delete(peerId);this.socket.removeAllListeners()}_cleanupPeer(peerId){const connections=this._connections.get(peerId);if(connections)for(const connection of connections)connection.close()}disconnect(){if(this.disconnected)return;const currentId=this.id;$257947e92926277a$export$2e2bcd8739ae039.log(`Disconnect peer with ID:${currentId}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=currentId,this._id=null,this.emit("disconnected",currentId)}reconnect(){if(this.disconnected&&!this.destroyed)$257947e92926277a$export$2e2bcd8739ae039.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);$257947e92926277a$export$2e2bcd8739ae039.error("In a hurry? We're still trying to make the initial connection!")}}listAllPeers(cb=(_=>{})){this._api.listAllPeers().then((peers=>cb(peers))).catch((error=>this._abort($78455e22dea96b8c$export$9547aaa2e39030ff.ServerError,error)))}}var $dd0187d7f28e386f$export$2e2bcd8739ae039=$416260bce337df90$export$ecd1fc136c422448},"./node_modules/sdp/sdp.js":module=>{const SDPUtils={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};SDPUtils.localCName=SDPUtils.generateIdentifier(),SDPUtils.splitLines=function(blob){return blob.trim().split("\n").map((line=>line.trim()))},SDPUtils.splitSections=function(blob){return blob.split("\nm=").map(((part,index)=>(index>0?"m="+part:part).trim()+"\r\n"))},SDPUtils.getDescription=function(blob){const sections=SDPUtils.splitSections(blob);return sections&&sections[0]},SDPUtils.getMediaSections=function(blob){const sections=SDPUtils.splitSections(blob);return sections.shift(),sections},SDPUtils.matchPrefix=function(blob,prefix){return SDPUtils.splitLines(blob).filter((line=>0===line.indexOf(prefix)))},SDPUtils.parseCandidate=function(line){let parts;parts=0===line.indexOf("a=candidate:")?line.substring(12).split(" "):line.substring(10).split(" ");const candidate={foundation:parts[0],component:{1:"rtp",2:"rtcp"}[parts[1]]||parts[1],protocol:parts[2].toLowerCase(),priority:parseInt(parts[3],10),ip:parts[4],address:parts[4],port:parseInt(parts[5],10),type:parts[7]};for(let i=8;i<parts.length;i+=2)switch(parts[i]){case"raddr":candidate.relatedAddress=parts[i+1];break;case"rport":candidate.relatedPort=parseInt(parts[i+1],10);break;case"tcptype":candidate.tcpType=parts[i+1];break;case"ufrag":candidate.ufrag=parts[i+1],candidate.usernameFragment=parts[i+1];break;default:void 0===candidate[parts[i]]&&(candidate[parts[i]]=parts[i+1])}return candidate},SDPUtils.writeCandidate=function(candidate){const sdp=[];sdp.push(candidate.foundation);const component=candidate.component;"rtp"===component?sdp.push(1):"rtcp"===component?sdp.push(2):sdp.push(component),sdp.push(candidate.protocol.toUpperCase()),sdp.push(candidate.priority),sdp.push(candidate.address||candidate.ip),sdp.push(candidate.port);const type=candidate.type;return sdp.push("typ"),sdp.push(type),"host"!==type&&candidate.relatedAddress&&candidate.relatedPort&&(sdp.push("raddr"),sdp.push(candidate.relatedAddress),sdp.push("rport"),sdp.push(candidate.relatedPort)),candidate.tcpType&&"tcp"===candidate.protocol.toLowerCase()&&(sdp.push("tcptype"),sdp.push(candidate.tcpType)),(candidate.usernameFragment||candidate.ufrag)&&(sdp.push("ufrag"),sdp.push(candidate.usernameFragment||candidate.ufrag)),"candidate:"+sdp.join(" ")},SDPUtils.parseIceOptions=function(line){return line.substring(14).split(" ")},SDPUtils.parseRtpMap=function(line){let parts=line.substring(9).split(" ");const parsed={payloadType:parseInt(parts.shift(),10)};return parts=parts[0].split("/"),parsed.name=parts[0],parsed.clockRate=parseInt(parts[1],10),parsed.channels=3===parts.length?parseInt(parts[2],10):1,parsed.numChannels=parsed.channels,parsed},SDPUtils.writeRtpMap=function(codec){let pt=codec.payloadType;void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType);const channels=codec.channels||codec.numChannels||1;return"a=rtpmap:"+pt+" "+codec.name+"/"+codec.clockRate+(1!==channels?"/"+channels:"")+"\r\n"},SDPUtils.parseExtmap=function(line){const parts=line.substring(9).split(" ");return{id:parseInt(parts[0],10),direction:parts[0].indexOf("/")>0?parts[0].split("/")[1]:"sendrecv",uri:parts[1],attributes:parts.slice(2).join(" ")}},SDPUtils.writeExtmap=function(headerExtension){return"a=extmap:"+(headerExtension.id||headerExtension.preferredId)+(headerExtension.direction&&"sendrecv"!==headerExtension.direction?"/"+headerExtension.direction:"")+" "+headerExtension.uri+(headerExtension.attributes?" "+headerExtension.attributes:"")+"\r\n"},SDPUtils.parseFmtp=function(line){const parsed={};let kv;const parts=line.substring(line.indexOf(" ")+1).split(";");for(let j=0;j<parts.length;j++)kv=parts[j].trim().split("="),parsed[kv[0].trim()]=kv[1];return parsed},SDPUtils.writeFmtp=function(codec){let line="",pt=codec.payloadType;if(void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.parameters&&Object.keys(codec.parameters).length){const params=[];Object.keys(codec.parameters).forEach((param=>{void 0!==codec.parameters[param]?params.push(param+"="+codec.parameters[param]):params.push(param)})),line+="a=fmtp:"+pt+" "+params.join(";")+"\r\n"}return line},SDPUtils.parseRtcpFb=function(line){const parts=line.substring(line.indexOf(" ")+1).split(" ");return{type:parts.shift(),parameter:parts.join(" ")}},SDPUtils.writeRtcpFb=function(codec){let lines="",pt=codec.payloadType;return void 0!==codec.preferredPayloadType&&(pt=codec.preferredPayloadType),codec.rtcpFeedback&&codec.rtcpFeedback.length&&codec.rtcpFeedback.forEach((fb=>{lines+="a=rtcp-fb:"+pt+" "+fb.type+(fb.parameter&&fb.parameter.length?" "+fb.parameter:"")+"\r\n"})),lines},SDPUtils.parseSsrcMedia=function(line){const sp=line.indexOf(" "),parts={ssrc:parseInt(line.substring(7,sp),10)},colon=line.indexOf(":",sp);return colon>-1?(parts.attribute=line.substring(sp+1,colon),parts.value=line.substring(colon+1)):parts.attribute=line.substring(sp+1),parts},SDPUtils.parseSsrcGroup=function(line){const parts=line.substring(13).split(" ");return{semantics:parts.shift(),ssrcs:parts.map((ssrc=>parseInt(ssrc,10)))}},SDPUtils.getMid=function(mediaSection){const mid=SDPUtils.matchPrefix(mediaSection,"a=mid:")[0];if(mid)return mid.substring(6)},SDPUtils.parseFingerprint=function(line){const parts=line.substring(14).split(" ");return{algorithm:parts[0].toLowerCase(),value:parts[1].toUpperCase()}},SDPUtils.getDtlsParameters=function(mediaSection,sessionpart){return{role:"auto",fingerprints:SDPUtils.matchPrefix(mediaSection+sessionpart,"a=fingerprint:").map(SDPUtils.parseFingerprint)}},SDPUtils.writeDtlsParameters=function(params,setupType){let sdp="a=setup:"+setupType+"\r\n";return params.fingerprints.forEach((fp=>{sdp+="a=fingerprint:"+fp.algorithm+" "+fp.value+"\r\n"})),sdp},SDPUtils.parseCryptoLine=function(line){const parts=line.substring(9).split(" ");return{tag:parseInt(parts[0],10),cryptoSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3)}},SDPUtils.writeCryptoLine=function(parameters){return"a=crypto:"+parameters.tag+" "+parameters.cryptoSuite+" "+("object"==typeof parameters.keyParams?SDPUtils.writeCryptoKeyParams(parameters.keyParams):parameters.keyParams)+(parameters.sessionParams?" "+parameters.sessionParams.join(" "):"")+"\r\n"},SDPUtils.parseCryptoKeyParams=function(keyParams){if(0!==keyParams.indexOf("inline:"))return null;const parts=keyParams.substring(7).split("|");return{keyMethod:"inline",keySalt:parts[0],lifeTime:parts[1],mkiValue:parts[2]?parts[2].split(":")[0]:void 0,mkiLength:parts[2]?parts[2].split(":")[1]:void 0}},SDPUtils.writeCryptoKeyParams=function(keyParams){return keyParams.keyMethod+":"+keyParams.keySalt+(keyParams.lifeTime?"|"+keyParams.lifeTime:"")+(keyParams.mkiValue&&keyParams.mkiLength?"|"+keyParams.mkiValue+":"+keyParams.mkiLength:"")},SDPUtils.getCryptoParameters=function(mediaSection,sessionpart){return SDPUtils.matchPrefix(mediaSection+sessionpart,"a=crypto:").map(SDPUtils.parseCryptoLine)},SDPUtils.getIceParameters=function(mediaSection,sessionpart){const ufrag=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-ufrag:")[0],pwd=SDPUtils.matchPrefix(mediaSection+sessionpart,"a=ice-pwd:")[0];return ufrag&&pwd?{usernameFragment:ufrag.substring(12),password:pwd.substring(10)}:null},SDPUtils.writeIceParameters=function(params){let sdp="a=ice-ufrag:"+params.usernameFragment+"\r\na=ice-pwd:"+params.password+"\r\n";return params.iceLite&&(sdp+="a=ice-lite\r\n"),sdp},SDPUtils.parseRtpParameters=function(mediaSection){const description={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},mline=SDPUtils.splitLines(mediaSection)[0].split(" ");description.profile=mline[2];for(let i=3;i<mline.length;i++){const pt=mline[i],rtpmapline=SDPUtils.matchPrefix(mediaSection,"a=rtpmap:"+pt+" ")[0];if(rtpmapline){const codec=SDPUtils.parseRtpMap(rtpmapline),fmtps=SDPUtils.matchPrefix(mediaSection,"a=fmtp:"+pt+" ");switch(codec.parameters=fmtps.length?SDPUtils.parseFmtp(fmtps[0]):{},codec.rtcpFeedback=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:"+pt+" ").map(SDPUtils.parseRtcpFb),description.codecs.push(codec),codec.name.toUpperCase()){case"RED":case"ULPFEC":description.fecMechanisms.push(codec.name.toUpperCase())}}}SDPUtils.matchPrefix(mediaSection,"a=extmap:").forEach((line=>{description.headerExtensions.push(SDPUtils.parseExtmap(line))}));const wildcardRtcpFb=SDPUtils.matchPrefix(mediaSection,"a=rtcp-fb:* ").map(SDPUtils.parseRtcpFb);return description.codecs.forEach((codec=>{wildcardRtcpFb.forEach((fb=>{codec.rtcpFeedback.find((existingFeedback=>existingFeedback.type===fb.type&&existingFeedback.parameter===fb.parameter))||codec.rtcpFeedback.push(fb)}))})),description},SDPUtils.writeRtpDescription=function(kind,caps){let sdp="";sdp+="m="+kind+" ",sdp+=caps.codecs.length>0?"9":"0",sdp+=" "+(caps.profile||"UDP/TLS/RTP/SAVPF")+" ",sdp+=caps.codecs.map((codec=>void 0!==codec.preferredPayloadType?codec.preferredPayloadType:codec.payloadType)).join(" ")+"\r\n",sdp+="c=IN IP4 0.0.0.0\r\n",sdp+="a=rtcp:9 IN IP4 0.0.0.0\r\n",caps.codecs.forEach((codec=>{sdp+=SDPUtils.writeRtpMap(codec),sdp+=SDPUtils.writeFmtp(codec),sdp+=SDPUtils.writeRtcpFb(codec)}));let maxptime=0;return caps.codecs.forEach((codec=>{codec.maxptime>maxptime&&(maxptime=codec.maxptime)})),maxptime>0&&(sdp+="a=maxptime:"+maxptime+"\r\n"),caps.headerExtensions&&caps.headerExtensions.forEach((extension=>{sdp+=SDPUtils.writeExtmap(extension)})),sdp},SDPUtils.parseRtpEncodingParameters=function(mediaSection){const encodingParameters=[],description=SDPUtils.parseRtpParameters(mediaSection),hasRed=-1!==description.fecMechanisms.indexOf("RED"),hasUlpfec=-1!==description.fecMechanisms.indexOf("ULPFEC"),ssrcs=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((line=>SDPUtils.parseSsrcMedia(line))).filter((parts=>"cname"===parts.attribute)),primarySsrc=ssrcs.length>0&&ssrcs[0].ssrc;let secondarySsrc;const flows=SDPUtils.matchPrefix(mediaSection,"a=ssrc-group:FID").map((line=>line.substring(17).split(" ").map((part=>parseInt(part,10)))));flows.length>0&&flows[0].length>1&&flows[0][0]===primarySsrc&&(secondarySsrc=flows[0][1]),description.codecs.forEach((codec=>{if("RTX"===codec.name.toUpperCase()&&codec.parameters.apt){let encParam={ssrc:primarySsrc,codecPayloadType:parseInt(codec.parameters.apt,10)};primarySsrc&&secondarySsrc&&(encParam.rtx={ssrc:secondarySsrc}),encodingParameters.push(encParam),hasRed&&(encParam=JSON.parse(JSON.stringify(encParam)),encParam.fec={ssrc:primarySsrc,mechanism:hasUlpfec?"red+ulpfec":"red"},encodingParameters.push(encParam))}})),0===encodingParameters.length&&primarySsrc&&encodingParameters.push({ssrc:primarySsrc});let bandwidth=SDPUtils.matchPrefix(mediaSection,"b=");return bandwidth.length&&(bandwidth=0===bandwidth[0].indexOf("b=TIAS:")?parseInt(bandwidth[0].substring(7),10):0===bandwidth[0].indexOf("b=AS:")?1e3*parseInt(bandwidth[0].substring(5),10)*.95-16e3:void 0,encodingParameters.forEach((params=>{params.maxBitrate=bandwidth}))),encodingParameters},SDPUtils.parseRtcpParameters=function(mediaSection){const rtcpParameters={},remoteSsrc=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((line=>SDPUtils.parseSsrcMedia(line))).filter((obj=>"cname"===obj.attribute))[0];remoteSsrc&&(rtcpParameters.cname=remoteSsrc.value,rtcpParameters.ssrc=remoteSsrc.ssrc);const rsize=SDPUtils.matchPrefix(mediaSection,"a=rtcp-rsize");rtcpParameters.reducedSize=rsize.length>0,rtcpParameters.compound=0===rsize.length;const mux=SDPUtils.matchPrefix(mediaSection,"a=rtcp-mux");return rtcpParameters.mux=mux.length>0,rtcpParameters},SDPUtils.writeRtcpParameters=function(rtcpParameters){let sdp="";return rtcpParameters.reducedSize&&(sdp+="a=rtcp-rsize\r\n"),rtcpParameters.mux&&(sdp+="a=rtcp-mux\r\n"),void 0!==rtcpParameters.ssrc&&rtcpParameters.cname&&(sdp+="a=ssrc:"+rtcpParameters.ssrc+" cname:"+rtcpParameters.cname+"\r\n"),sdp},SDPUtils.parseMsid=function(mediaSection){let parts;const spec=SDPUtils.matchPrefix(mediaSection,"a=msid:");if(1===spec.length)return parts=spec[0].substring(7).split(" "),{stream:parts[0],track:parts[1]};const planB=SDPUtils.matchPrefix(mediaSection,"a=ssrc:").map((line=>SDPUtils.parseSsrcMedia(line))).filter((msidParts=>"msid"===msidParts.attribute));return planB.length>0?(parts=planB[0].value.split(" "),{stream:parts[0],track:parts[1]}):void 0},SDPUtils.parseSctpDescription=function(mediaSection){const mline=SDPUtils.parseMLine(mediaSection),maxSizeLine=SDPUtils.matchPrefix(mediaSection,"a=max-message-size:");let maxMessageSize;maxSizeLine.length>0&&(maxMessageSize=parseInt(maxSizeLine[0].substring(19),10)),isNaN(maxMessageSize)&&(maxMessageSize=65536);const sctpPort=SDPUtils.matchPrefix(mediaSection,"a=sctp-port:");if(sctpPort.length>0)return{port:parseInt(sctpPort[0].substring(12),10),protocol:mline.fmt,maxMessageSize};const sctpMapLines=SDPUtils.matchPrefix(mediaSection,"a=sctpmap:");if(sctpMapLines.length>0){const parts=sctpMapLines[0].substring(10).split(" ");return{port:parseInt(parts[0],10),protocol:parts[1],maxMessageSize}}},SDPUtils.writeSctpDescription=function(media,sctp){let output=[];return output="DTLS/SCTP"!==media.protocol?["m="+media.kind+" 9 "+media.protocol+" "+sctp.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+sctp.port+"\r\n"]:["m="+media.kind+" 9 "+media.protocol+" "+sctp.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+sctp.port+" "+sctp.protocol+" 65535\r\n"],void 0!==sctp.maxMessageSize&&output.push("a=max-message-size:"+sctp.maxMessageSize+"\r\n"),output.join("")},SDPUtils.generateSessionId=function(){return Math.random().toString().substr(2,22)},SDPUtils.writeSessionBoilerplate=function(sessId,sessVer,sessUser){let sessionId;const version=void 0!==sessVer?sessVer:2;sessionId=sessId||SDPUtils.generateSessionId();return"v=0\r\no="+(sessUser||"thisisadapterortc")+" "+sessionId+" "+version+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},SDPUtils.getDirection=function(mediaSection,sessionpart){const lines=SDPUtils.splitLines(mediaSection);for(let i=0;i<lines.length;i++)switch(lines[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return lines[i].substring(2)}return sessionpart?SDPUtils.getDirection(sessionpart):"sendrecv"},SDPUtils.getKind=function(mediaSection){return SDPUtils.splitLines(mediaSection)[0].split(" ")[0].substring(2)},SDPUtils.isRejected=function(mediaSection){return"0"===mediaSection.split(" ",2)[1]},SDPUtils.parseMLine=function(mediaSection){const parts=SDPUtils.splitLines(mediaSection)[0].substring(2).split(" ");return{kind:parts[0],port:parseInt(parts[1],10),protocol:parts[2],fmt:parts.slice(3).join(" ")}},SDPUtils.parseOLine=function(mediaSection){const parts=SDPUtils.matchPrefix(mediaSection,"o=")[0].substring(2).split(" ");return{username:parts[0],sessionId:parts[1],sessionVersion:parseInt(parts[2],10),netType:parts[3],addressType:parts[4],address:parts[5]}},SDPUtils.isValidSDP=function(blob){if("string"!=typeof blob||0===blob.length)return!1;const lines=SDPUtils.splitLines(blob);for(let i=0;i<lines.length;i++)if(lines[i].length<2||"="!==lines[i].charAt(1))return!1;return!0},module.exports=SDPUtils}}]);